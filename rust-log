yarn run v1.22.22
$ cd src-tauri && cargo clippy -- -D warnings
warning: nexo@0.1.0-alpha.48: Binary found: /Users/nkthanh/code/nexo-project/nexo/src-tauri/binaries/uv
warning: nexo@0.1.0-alpha.48: Binary found: /Users/nkthanh/code/nexo-project/nexo/src-tauri/binaries/fnm
warning: nexo@0.1.0-alpha.48: RUST_SENTRY_DSN not set - Sentry will be disabled
    Checking nexo v0.1.0-alpha.48 (/Users/nkthanh/code/nexo-project/nexo/src-tauri)
error: empty line after doc comment
  --> src/lib/sentry_helpers.rs:3:1
   |
3  | / /// This module provides utilities for tracking commands, operations, and errors
4  | |
   | |_^
...
18 |   macro_rules! track_command {
   |   -------------------------- the comment documents this macro definition
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#empty_line_after_doc_comments
   = note: `-D clippy::empty-line-after-doc-comments` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::empty_line_after_doc_comments)]`
   = help: if the empty line is unintentional, remove it
help: if the comment should document the parent module use an inner doc comment
   |
1  ~ //! Sentry helper functions and macros for consistent tracking
2  ~ //!
3  ~ //! This module provides utilities for tracking commands, operations, and errors
   |
help: if the documentation should include the empty line include it in the comment
   |
4  | ///
   |

error: variable does not need to be mutable
   --> src/services/llm/providers/openai.rs:204:13
    |
204 |         let mut tool_calls_emitted = false;
    |             ----^^^^^^^^^^^^^^^^^^
    |             |
    |             help: remove this `mut`
    |
    = note: `-D unused-mut` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(unused_mut)]`

error: unnecessary semicolon
  --> src/db/connection.rs:23:6
   |
23 |     };
   |      ^ help: remove
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unnecessary_semicolon
   = note: `-D clippy::unnecessary-semicolon` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::unnecessary_semicolon)]`

error: matching over `()` is more explicit
  --> src/db/connection.rs:16:12
   |
16 |         Ok(_) => {}
   |            ^ help: use `()` instead of `_`: `()`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#ignored_unit_patterns
   = note: `-D clippy::ignored-unit-patterns` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::ignored_unit_patterns)]`

error: this could be a `const fn`
  --> src/events/agent_emitter.rs:11:5
   |
11 | /     pub fn new(app: AppHandle) -> Self {
12 | |         Self { app }
13 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
   = note: `-D clippy::missing-const-for-fn` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::missing_const_for_fn)]`
help: make the function `const`
   |
11 |     pub const fn new(app: AppHandle) -> Self {
   |         +++++

error: this could be a `const fn`
  --> src/events/tool_emitter.rs:14:5
   |
14 | /     pub fn new(app: AppHandle) -> Self {
15 | |         Self { app }
16 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
14 |     pub const fn new(app: AppHandle) -> Self {
   |         +++++

error: this function has too many arguments (8/7)
  --> src/events/tool_emitter.rs:58:5
   |
58 | /     pub fn emit_tool_execution_progress(
59 | |         &self,
60 | |         chat_id: String,
61 | |         message_id: String,
...  |
66 | |         error: Option<String>,
67 | |     ) -> Result<(), AppError> {
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments
   = note: `-D clippy::too-many-arguments` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::too_many_arguments)]`

error: all fields have the same postfix: `id`
  --> src/events/mod.rs:15:1
   |
15 | / pub struct MessageStartedEvent {
16 | |     pub chat_id: String,
17 | |     pub user_message_id: String,
18 | |     pub assistant_message_id: String,
19 | | }
   | |_^
   |
   = help: remove the postfixes
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#struct_field_names
   = note: `-D clippy::struct-field-names` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::struct_field_names)]`

error: all fields have the same postfix: `tokens`
  --> src/events/mod.rs:57:1
   |
57 | / pub struct TokenUsage {
58 | |     pub prompt_tokens: Option<u32>,
59 | |     pub completion_tokens: Option<u32>,
60 | |     pub total_tokens: Option<u32>,
61 | | }
   | |_^
   |
   = help: remove the postfixes
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#struct_field_names

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/commands.rs:11:12
   |
11 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
   = note: `-D clippy::needless-pass-by-value` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::needless_pass_by_value)]`
help: consider taking a reference instead
   |
11 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/commands.rs:24:12
   |
24 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
24 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/commands.rs:33:32
   |
33 | pub fn get_chats(workspace_id: String, state: State<'_, AppState>) -> Result<Vec<Chat>, AppError> {
   |                                ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/commands.rs:33:47
   |
33 | pub fn get_chats(workspace_id: String, state: State<'_, AppState>) -> Result<Vec<Chat>, AppError> {
   |                                               ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
33 | pub fn get_chats(workspace_id: String, state: &State<'_, AppState>) -> Result<Vec<Chat>, AppError> {
   |                                               +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/commands.rs:45:12
   |
45 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
45 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/commands.rs:54:39
   |
54 | pub fn delete_chat(id: String, state: State<'_, AppState>) -> Result<(), AppError> {
   |                                       ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
54 | pub fn delete_chat(id: String, state: &State<'_, AppState>) -> Result<(), AppError> {
   |                                       +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/commands.rs:64:12
   |
64 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
64 |     state: &State<'_, AppState>,
   |            +

error: this function has too many arguments (8/7)
  --> src/features/chat/commands.rs:78:1
   |
78 | / pub async fn send_message(
79 | |     chat_id: String,
80 | |     content: String,
81 | |     files: Option<Vec<String>>,
...  |
86 | |     state: State<'_, AppState>,
87 | | ) -> Result<SendMessageResult, AppError> {
   | |________________________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this function has too many arguments (9/7)
   --> src/features/chat/commands.rs:109:1
    |
109 | / pub async fn edit_and_resend_message(
110 | |     chat_id: String,
111 | |     message_id: String,
112 | |     new_content: String,
...   |
118 | |     state: State<'_, AppState>,
119 | | ) -> Result<SendMessageResult, AppError> {
    | |________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this argument is passed by value, but not consumed in the function body
   --> src/features/chat/commands.rs:143:17
    |
143 |     message_id: String,
    |                 ^^^^^^ help: consider changing the type to: `&str`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
   --> src/features/chat/commands.rs:146:12
    |
146 |     state: State<'_, AppState>,
    |            ^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
    |
146 |     state: &State<'_, AppState>,
    |            +

error: this could be a `const fn`
  --> src/features/chat/emitter.rs:11:5
   |
11 | /     pub fn new(app: AppHandle) -> Self {
12 | |         Self { app }
13 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
11 |     pub const fn new(app: AppHandle) -> Self {
   |         +++++

error: this argument is passed by value, but not consumed in the function body
 --> src/features/chat/input_settings/commands.rs:8:19
  |
8 |     workspace_id: String,
  |                   ^^^^^^ help: consider changing the type to: `&str`
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
 --> src/features/chat/input_settings/commands.rs:9:12
  |
9 |     state: State<'_, AppState>,
  |            ^^^^^^^^^^^^^^^^^^^
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
  |
9 |     state: &State<'_, AppState>,
  |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/input_settings/commands.rs:19:19
   |
19 |     workspace_id: String,
   |                   ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/input_settings/commands.rs:20:21
   |
20 |     selected_model: Option<String>,
   |                     ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
20 |     selected_model: Option<&String>,
   |                            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/chat/input_settings/commands.rs:22:12
   |
22 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
22 |     state: &State<'_, AppState>,
   |            +

error: this could be a `const fn`
  --> src/features/chat/input_settings/repository.rs:20:5
   |
20 | /     pub fn new(app: Arc<AppHandle>) -> Self {
21 | |         Self { app }
22 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
20 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casting `u64` to `i64` may wrap around the value
  --> src/features/chat/input_settings/service.rs:21:19
   |
21 |           let now = std::time::SystemTime::now()
   |  ___________________^
22 | |             .duration_since(std::time::UNIX_EPOCH)
23 | |             .unwrap()
24 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap
   = note: `-D clippy::cast-possible-wrap` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::cast_possible_wrap)]`

error: boolean to int conversion using if
  --> src/features/chat/input_settings/service.rs:26:39
   |
26 |         let stream_enabled_i64: i64 = if stream_enabled { 1 } else { 0 };
   |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with from: `i64::from(stream_enabled)`
   |
   = note: `stream_enabled as i64` or `stream_enabled.into()` can also be valid options
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#bool_to_int_with_if
   = note: `-D clippy::bool-to-int-with-if` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::bool_to_int_with_if)]`

error: redundant closure
  --> src/features/chat/input_settings/service.rs:30:48
   |
30 |             selected_model: selected_model.map(|s| s.to_string()),
   |                                                ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls
   = note: `-D clippy::redundant-closure-for-method-calls` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::redundant_closure_for_method_calls)]`

error: this could be a `const fn`
  --> src/features/chat/repository.rs:31:5
   |
31 | /     pub fn new(app: Arc<AppHandle>) -> Self {
32 | |         Self { app }
33 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
31 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casting `u64` to `i64` may wrap around the value
   --> src/features/chat/repository.rs:133:19
    |
133 |           let now = std::time::SystemTime::now()
    |  ___________________^
134 | |             .duration_since(std::time::UNIX_EPOCH)
135 | |             .unwrap()
136 | |             .as_secs() as i64;
    | |_____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: usage of wildcard import
  --> src/features/chat/service.rs:10:5
   |
10 | use crate::models::llm_types::*;
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `crate::models::llm_types::{ChatCompletionTool, ToolChoice, LLMChatRequest, LLMChatResponse, ChatMessage, AssistantContent, UserContent, ContentPart, ImageUrl, FileUrl}`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports
   = note: `-D clippy::wildcard-imports` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::wildcard_imports)]`

error: this function has too many arguments (8/7)
  --> src/features/chat/service.rs:37:5
   |
37 | /     pub fn new(
38 | |         repository: Arc<dyn ChatRepository>,
39 | |         llm_service: Arc<LLMService>,
40 | |         message_service: Arc<MessageService>,
...  |
45 | |         agent_manager: Arc<crate::features::agent::manager::AgentManager>,
46 | |     ) -> Self {
   | |_____________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: unused `self` argument
  --> src/features/chat/service.rs:61:26
   |
61 |     fn save_file_to_disk(&self, app: &AppHandle, file_data: &str) -> Result<String, AppError> {
   |                          ^^^^^
   |
   = help: consider refactoring to an associated function
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self
   = note: `-D clippy::unused-self` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::unused_self)]`

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:109:47
    |
109 |             .map_err(|e| AppError::Validation(format!("Failed to decode base64 file: {}", e)))?;
    |                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
    = note: `-D clippy::uninlined-format-args` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::uninlined_format_args)]`
help: change this to
    |
109 -             .map_err(|e| AppError::Validation(format!("Failed to decode base64 file: {}", e)))?;
109 +             .map_err(|e| AppError::Validation(format!("Failed to decode base64 file: {e}")))?;
    |

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:120:35
    |
120 |                 AppError::Generic(format!("Failed to create files directory: {}", e))
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
120 -                 AppError::Generic(format!("Failed to create files directory: {}", e))
120 +                 AppError::Generic(format!("Failed to create files directory: {e}"))
    |

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:129:44
    |
129 |             .map_err(|e| AppError::Generic(format!("Failed to write file: {}", e)))?;
    |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
129 -             .map_err(|e| AppError::Generic(format!("Failed to write file: {}", e)))?;
129 +             .map_err(|e| AppError::Generic(format!("Failed to write file: {e}")))?;
    |

error: unused `self` argument
   --> src/features/chat/service.rs:153:26
    |
153 |     fn load_file_content(&self, path_or_data: &str) -> Result<(String, String), AppError> {
    |                          ^^^^^
    |
    = help: consider refactoring to an associated function
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:168:52
    |
168 |                     .map_err(|e| AppError::Generic(format!("Failed to read file: {}", e)))?;
    |                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
168 -                     .map_err(|e| AppError::Generic(format!("Failed to read file: {}", e)))?;
168 +                     .map_err(|e| AppError::Generic(format!("Failed to read file: {e}")))?;
    |

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:199:21
    |
199 |                     format!("data:{};base64,{}", mime, encoded),
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
199 -                     format!("data:{};base64,{}", mime, encoded),
199 +                     format!("data:{mime};base64,{encoded}"),
    |

error: temporary with significant `Drop` can be early dropped
   --> src/features/chat/service.rs:214:13
    |
212 |       pub fn cancel_message(&self, chat_id: &str) -> Result<(), AppError> {
    |  _________________________________________________________________________-
213 | |         // Try to send cancellation signal
214 | |         let senders = futures::executor::block_on(self.cancellation_senders.lock());
    | |             ^^^^^^^
215 | |         if let Some(sender) = senders.get(chat_id) {
...   |
219 | |         Ok(())
220 | |     }
    | |_____- temporary `senders` is currently being dropped at the end of its contained scope
    |
    = note: this might lead to unnecessary resource contention
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#significant_drop_tightening
    = note: `-D clippy::significant-drop-tightening` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::significant_drop_tightening)]`
help: merge the temporary construction with its single usage
    |
214 ~         
215 +         futures::executor::block_on(self.cancellation_senders.lock()).;
216 ~         
    |

error: this function's return value is unnecessary
   --> src/features/chat/service.rs:212:5
    |
212 | /     pub fn cancel_message(&self, chat_id: &str) -> Result<(), AppError> {
213 | |         // Try to send cancellation signal
214 | |         let senders = futures::executor::block_on(self.cancellation_senders.lock());
215 | |         if let Some(sender) = senders.get(chat_id) {
...   |
219 | |         Ok(())
220 | |     }
    | |_____^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unnecessary_wraps
    = note: `-D clippy::unnecessary-wraps` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::unnecessary_wraps)]`
help: remove the return type...
    |
212 -     pub fn cancel_message(&self, chat_id: &str) -> Result<(), AppError> {
212 +     pub fn cancel_message(&self, chat_id: &str) -> () {
    |
help: ...and then remove returned values
    |
219 -         Ok(())
    |

error: temporary with significant `Drop` can be early dropped
   --> src/features/chat/service.rs:227:17
    |
226 |       ) -> tokio::sync::broadcast::Receiver<()> {
    |  _______________________________________________-
227 | |         let mut senders = self.cancellation_senders.lock().await;
    | |                 ^^^^^^^
228 | |         let sender = senders
229 | |             .entry(chat_id.to_string())
230 | |             .or_insert_with(|| tokio::sync::broadcast::channel(1).0);
231 | |         sender.subscribe()
232 | |     }
    | |_____- temporary `senders` is currently being dropped at the end of its contained scope
    |
    = note: this might lead to unnecessary resource contention
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#significant_drop_tightening
help: merge the temporary construction with its single usage
    |
227 ~         
228 +         let sender = self.cancellation_senders.lock().await.or_insert_with(|| tokio::sync::broadcast::channel(1).0);
229 ~         
    |

error: casting `u64` to `i64` may wrap around the value
   --> src/features/chat/service.rs:242:19
    |
242 |           let now = std::time::SystemTime::now()
    |  ___________________^
243 | |             .duration_since(std::time::UNIX_EPOCH)
244 | |             .unwrap()
245 | |             .as_secs() as i64;
    | |_____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: this argument is passed by value, but not consumed in the function body
   --> src/features/chat/service.rs:313:13
    |
313 |         id: String,
    |             ^^^^^^ help: consider changing the type to: `&str`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
   --> src/features/chat/service.rs:314:16
    |
314 |         title: Option<String>,
    |                ^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
    |
314 |         title: Option<&String>,
    |                       +

error: this argument is passed by value, but not consumed in the function body
   --> src/features/chat/service.rs:315:23
    |
315 |         last_message: Option<String>,
    |                       ^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
    |
315 |         last_message: Option<&String>,
    |                              +

error: this argument is passed by value, but not consumed in the function body
   --> src/features/chat/service.rs:321:30
    |
321 |     pub fn delete(&self, id: String) -> Result<(), AppError> {
    |                              ^^^^^^ help: consider changing the type to: `&str`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
   --> src/features/chat/service.rs:325:56
    |
325 |     pub fn delete_by_workspace_id(&self, workspace_id: String) -> Result<(), AppError> {
    |                                                        ^^^^^^ help: consider changing the type to: `&str`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this function has too many arguments (8/7)
   --> src/features/chat/service.rs:354:5
    |
354 | /     pub async fn send_message(
355 | |         &self,
356 | |         chat_id: String,
357 | |         content: String,
...   |
362 | |         app: AppHandle,
363 | |     ) -> Result<(String, String), AppError> {
    | |___________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: redundant clone
   --> src/features/chat/service.rs:492:60
    |
492 |                 let specialist_chat_id = specialist_chat.id.clone();
    |                                                            ^^^^^^^^ help: remove this
    |
note: this value is dropped without further use
   --> src/features/chat/service.rs:492:42
    |
492 |                 let specialist_chat_id = specialist_chat.id.clone();
    |                                          ^^^^^^^^^^^^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone
    = note: `-D clippy::redundant-clone` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::redundant_clone)]`

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:367:13
    |
367 |             format!("Sending message to chat {}", chat_id),
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
367 -             format!("Sending message to chat {}", chat_id),
367 +             format!("Sending message to chat {chat_id}"),
    |

error: function call inside of `or`
   --> src/features/chat/service.rs:392:14
    |
392 |             .or(workspace_settings.llm_connection_id.clone())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| workspace_settings.llm_connection_id.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call
    = note: `-D clippy::or-fun-call` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::or_fun_call)]`

error: function call inside of `or`
   --> src/features/chat/service.rs:409:14
    |
409 |             .or(llm_connection.default_model.clone())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| llm_connection.default_model.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: function call inside of `or`
   --> src/features/chat/service.rs:408:14
    |
408 |             .or(workspace_settings.default_model.clone())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| workspace_settings.default_model.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: casting `u64` to `i64` may wrap around the value
   --> src/features/chat/service.rs:416:30
    |
416 |           let user_timestamp = std::time::SystemTime::now()
    |  ______________________________^
417 | |             .duration_since(std::time::UNIX_EPOCH)
418 | |             .unwrap()
419 | |             .as_secs() as i64;
    | |_____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: use Option::map_or instead of an if let/else
   --> src/features/chat/service.rs:422:24
    |
422 |           let metadata = if let Some(file_list) = &processed_files {
    |  ________________________^
423 | |             if !file_list.is_empty() {
424 | |                 Some(serde_json::json!({ "files": file_list }).to_string())
425 | |             } else {
...   |
429 | |             None
430 | |         };
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
    = note: `-D clippy::option-if-let-else` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::option_if_let_else)]`
help: try
    |
422 ~         let metadata = processed_files.as_ref().map_or(None, |file_list| if !file_list.is_empty() {
423 +                 Some(serde_json::json!({ "files": file_list }).to_string())
424 +             } else {
425 +                 None
426 ~             });
    |

error: unnecessary boolean `not` operation
   --> src/features/chat/service.rs:423:13
    |
423 | /             if !file_list.is_empty() {
424 | |                 Some(serde_json::json!({ "files": file_list }).to_string())
425 | |             } else {
426 | |                 None
427 | |             }
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#if_not_else
    = note: `-D clippy::if-not-else` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::if_not_else)]`
help: try
    |
423 ~             if file_list.is_empty() {
424 +                 None
425 +             } else {
426 +                 Some(serde_json::json!({ "files": file_list }).to_string())
427 +             }
    |

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:515:25
    |
515 |                         eprintln!("Agent request failed: {}", e);
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
515 -                         eprintln!("Agent request failed: {}", e);
515 +                         eprintln!("Agent request failed: {e}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:538:25
    |
538 |                         eprintln!("Failed to update agent status: {}", e);
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
538 -                         eprintln!("Failed to update agent status: {}", e);
538 +                         eprintln!("Failed to update agent status: {e}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:546:29
    |
546 | ...                   eprintln!("Failed to emit metadata-updated event: {}", e);
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
546 -                             eprintln!("Failed to emit metadata-updated event: {}", e);
546 +                             eprintln!("Failed to emit metadata-updated event: {e}");
    |

error: empty String is being created manually
   --> src/features/chat/service.rs:563:13
    |
563 |             "".to_string(),
    |             ^^^^^^^^^^^^^^ help: consider using: `String::new()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_string_new
    = note: `-D clippy::manual-string-new` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::manual_string_new)]`

error: function call inside of `unwrap_or`
   --> src/features/chat/service.rs:605:67
    |
605 | ...                   serde_json::to_value(&t.input_schema).unwrap_or(serde_json::json!({})),
    |                                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `unwrap_or_else(|_| serde_json::json!({}))`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: called `map(<f>).unwrap_or(<a>)` on an `Option` value
   --> src/features/chat/service.rs:643:30
    |
643 |           let stream_enabled = workspace_settings
    |  ______________________________^
644 | |             .stream_enabled
645 | |             .map(|v| v == 1)
646 | |             .unwrap_or(true); // Default to true
    | |____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#map_unwrap_or
    = note: `-D clippy::map-unwrap-or` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::map_unwrap_or)]`
help: use `map_or(<a>, <f>)` instead
    |
645 -             .map(|v| v == 1)
645 +             .map_or(true, |v| v == 1); // Default to true
    |

error: casting `u128` to `u64` may truncate the value
   --> src/features/chat/service.rs:687:23
    |
687 |         let latency = start_time.elapsed().as_millis() as u64;
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
    = note: `-D clippy::cast-possible-truncation` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::cast_possible_truncation)]`
help: ... or use `try_from` and handle the error accordingly
    |
687 -         let latency = start_time.elapsed().as_millis() as u64;
687 +         let latency = u64::try_from(start_time.elapsed().as_millis());
    |

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:720:17
    |
720 |                 eprintln!("Failed to record usage: {}", e);
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
720 -                 eprintln!("Failed to record usage: {}", e);
720 +                 eprintln!("Failed to record usage: {e}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/chat/service.rs:769:21
    |
769 |                     eprintln!("Failed to emit metadata-updated event: {}", e);
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
769 -                     eprintln!("Failed to emit metadata-updated event: {}", e);
769 +                     eprintln!("Failed to emit metadata-updated event: {e}");
    |

error: this function has too many arguments (9/7)
   --> src/features/chat/service.rs:829:5
    |
829 | /     pub async fn edit_and_resend_message(
830 | |         &self,
831 | |         chat_id: String,
832 | |         message_id: String,
...   |
838 | |         app: AppHandle,
839 | |     ) -> Result<(String, String), AppError> {
    | |___________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this function has too many arguments (12/7)
   --> src/features/chat/service.rs:890:5
    |
890 | /     async fn send_message_with_agent_loop(
891 | |         &self,
892 | |         chat_id: String,
893 | |         user_content: String,
...   |
902 | |         llm_connection_id_override: Option<String>,
903 | |     ) -> Result<(String, String), AppError> {
    | |___________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: casting `i64` to `usize` may truncate the value on targets with 32-bit wide pointers
   --> src/features/chat/service.rs:916:30
    |
916 |         let max_iterations = workspace_settings.max_agent_iterations.unwrap_or(25) as usize;
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
916 -         let max_iterations = workspace_settings.max_agent_iterations.unwrap_or(25) as usize;
916 +         let max_iterations = usize::try_from(workspace_settings.max_agent_iterations.unwrap_or(25));
    |

error: casting `i64` to `usize` may lose the sign of the value
   --> src/features/chat/service.rs:916:30
    |
916 |         let max_iterations = workspace_settings.max_agent_iterations.unwrap_or(25) as usize;
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_sign_loss
    = note: `-D clippy::cast-sign-loss` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::cast_sign_loss)]`

error: function call inside of `or`
   --> src/features/chat/service.rs:919:14
    |
919 |             .or(workspace_settings.llm_connection_id.clone())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| workspace_settings.llm_connection_id.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: function call inside of `or`
   --> src/features/chat/service.rs:933:14
    |
933 |             .or(llm_connection.default_model.clone())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| llm_connection.default_model.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: function call inside of `or`
   --> src/features/chat/service.rs:932:14
    |
932 |             .or(workspace_settings.default_model.clone())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| workspace_settings.default_model.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: called `map(<f>).unwrap_or(<a>)` on an `Option` value
   --> src/features/chat/service.rs:936:30
    |
936 |           let stream_enabled = workspace_settings
    |  ______________________________^
937 | |             .stream_enabled
938 | |             .map(|v| v == 1)
939 | |             .unwrap_or(true);
    | |____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#map_unwrap_or
help: use `map_or(<a>, <f>)` instead
    |
938 -             .map(|v| v == 1)
938 +             .map_or(true, |v| v == 1);
    |

error: casting `u64` to `i64` may wrap around the value
   --> src/features/chat/service.rs:983:33
    |
983 |                   let timestamp = std::time::SystemTime::now()
    |  _________________________________^
984 | |                     .duration_since(std::time::UNIX_EPOCH)
985 | |                     .unwrap()
986 | |                     .as_secs() as i64;
    | |_____________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: empty String is being created manually
   --> src/features/chat/service.rs:993:21
    |
993 |                     "".to_string(),
    |                     ^^^^^^^^^^^^^^ help: consider using: `String::new()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_string_new

error: casting `u128` to `u64` may truncate the value
    --> src/features/chat/service.rs:1054:31
     |
1054 |                 let latency = start_time.elapsed().as_millis() as u64;
     |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     |
     = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
     |
1054 -                 let latency = start_time.elapsed().as_millis() as u64;
1054 +                 let latency = u64::try_from(start_time.elapsed().as_millis());
     |

error: variables can be used directly in the `format!` string
    --> src/features/chat/service.rs:1078:25
     |
1078 |                         eprintln!("Failed to record usage: {}", e);
     |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
     |
1078 -                         eprintln!("Failed to record usage: {}", e);
1078 +                         eprintln!("Failed to record usage: {e}");
     |

error: variables can be used directly in the `format!` string
    --> src/features/chat/service.rs:1130:29
     |
1130 | / ...                   eprintln!(
1131 | | ...                       "Tool execution failed in agent loop (chat_id: {}): {}",
1132 | | ...                       chat_id, e
1133 | | ...                   );
     | |_______________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
    --> src/features/chat/service.rs:1141:33
     |
1141 | ...                   format!("Tool execution failed: {}", e),
     |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
     |
1141 -                                 format!("Tool execution failed: {}", e),
1141 +                                 format!("Tool execution failed: {e}"),
     |

error: unused `self` argument
    --> src/features/chat/service.rs:1193:9
     |
1193 |         &self,
     |         ^^^^^
     |
     = help: consider refactoring to an associated function
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: this could be rewritten as `let...else`
    --> src/features/chat/service.rs:1208:17
     |
1208 | /                 let conn = match chat_service.llm_connection_service.get_by_id(&conn_id) {
1209 | |                     Ok(Some(conn)) => conn,
1210 | |                     _ => {
1211 | |                         return;
1212 | |                     }
1213 | |                 };
     | |__________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_let_else
     = note: `-D clippy::manual-let-else` implied by `-D warnings`
     = help: to override `-D warnings` add `#[allow(clippy::manual_let_else)]`
help: consider writing
     |
1208 ~                 let Ok(Some(conn)) = chat_service.llm_connection_service.get_by_id(&conn_id) else {
1209 +                         return;
1210 +                     };
     |

error: this could be rewritten as `let...else`
    --> src/features/chat/service.rs:1217:17
     |
1217 | /                 let chat = match chat_service.repository.get_by_id(&chat_id) {
1218 | |                     Ok(Some(c)) => c,
1219 | |                     _ => {
1220 | |                         return;
1221 | |                     }
1222 | |                 };
     | |__________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_let_else
help: consider writing
     |
1217 ~                 let Ok(Some(chat)) = chat_service.repository.get_by_id(&chat_id) else {
1218 +                         return;
1219 +                     };
     |

error: this could be rewritten as `let...else`
    --> src/features/chat/service.rs:1223:17
     |
1223 | /                 let settings = match chat_service
1224 | |                     .workspace_settings_service
1225 | |                     .get_by_workspace_id(&chat.workspace_id)
...    |
1231 | |                 };
     | |__________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_let_else
help: consider writing
     |
1223 ~                 let Ok(Some(settings)) = chat_service
1224 +                     .workspace_settings_service
1225 +                     .get_by_workspace_id(&chat.workspace_id) else {
1226 +                         return;
1227 +                     };
     |

error: this could be rewritten as `let...else`
    --> src/features/chat/service.rs:1232:17
     |
1232 | /                 let conn_id = match settings.llm_connection_id {
1233 | |                     Some(id) => id,
1234 | |                     None => {
1235 | |                         return;
1236 | |                     }
1237 | |                 };
     | |__________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_let_else
help: consider writing
     |
1232 ~                 let Some(conn_id) = settings.llm_connection_id else {
1233 +                         return;
1234 +                     };
     |

error: this could be rewritten as `let...else`
    --> src/features/chat/service.rs:1239:17
     |
1239 | /                 let conn = match chat_service.llm_connection_service.get_by_id(&conn_id) {
1240 | |                     Ok(Some(conn)) => conn,
1241 | |                     _ => {
1242 | |                         return;
1243 | |                     }
1244 | |                 };
     | |__________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_let_else
help: consider writing
     |
1239 ~                 let Ok(Some(conn)) = chat_service.llm_connection_service.get_by_id(&conn_id) else {
1240 +                         return;
1241 +                     };
     |

error: function call inside of `or`
    --> src/features/chat/service.rs:1250:18
     |
1250 |                 .or(llm_connection.default_model.clone())
     |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| llm_connection.default_model.clone())`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: variables can be used directly in the `format!` string
    --> src/features/chat/service.rs:1320:17
     |
1320 |                 eprintln!("Error generating chat title for chat_id {}: {}", chat_id, e);
     |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
     |
1320 -                 eprintln!("Error generating chat title for chat_id {}: {}", chat_id, e);
1320 +                 eprintln!("Error generating chat title for chat_id {chat_id}: {e}");
     |

error: temporary with significant `Drop` can be early dropped
    --> src/features/chat/service.rs:1400:29
     |
1396 |                   Err(_) => {
     |  ___________________________-
1397 | |                     // Timeout cleanup
1398 | |                     use tauri::Manager;
1399 | |                     let app_state: tauri::State<crate::state::AppState> = app.state();
1400 | |                     let mut pending = app_state.pending_tool_permissions.lock().map_err(|e| {
     | |                             ^^^^^^^
...    |
1407 | |                     ));
1408 | |                 }
     | |_________________- temporary `pending` is currently being dropped at the end of its contained scope
     |
     = note: this might lead to unnecessary resource contention
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#significant_drop_tightening
help: merge the temporary construction with its single usage
     |
1400 ~                     
1401 +                     app_state.pending_tool_permissions.lock().map_err(|e| {
1402 +                         AppError::Generic(format!("Failed to lock pending_tool_permissions: {e}"))
1403 +                     })?.remove(assistant_message_id);
1404 ~                     
     |

error: use Option::map_or_else instead of an if let/else
    --> src/features/chat/service.rs:1338:13
     |
1338 | /             if let Some(config_str) = &workspace_settings.tool_permission_config {
1339 | |                 serde_json::from_str(config_str).unwrap_or_default()
1340 | |             } else {
1341 | |                 HashMap::new()
1342 | |             };
     | |_____________^ help: try: `workspace_settings.tool_permission_config.as_ref().map_or_else(HashMap::new, |config_str| serde_json::from_str(config_str).unwrap_or_default())`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else

error: match expression looks like `matches!` macro
    --> src/features/chat/service.rs:1346:13
     |
1346 | /             match tool_permission_config
1347 | |                 .get(&tc.function.name)
1348 | |                 .map(|s| s.as_str())
...    |
1351 | |                 _ => false,
1352 | |             }
     | |_____________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#match_like_matches_macro
     = note: `-D clippy::match-like-matches-macro` implied by `-D warnings`
     = help: to override `-D warnings` add `#[allow(clippy::match_like_matches_macro)]`
help: try
     |
1346 ~             matches!(tool_permission_config
1347 +                 .get(&tc.function.name)
1348 +                 .map(|s| s.as_str()), Some("require"))
     |

error: redundant closure
    --> src/features/chat/service.rs:1348:22
     |
1348 |                 .map(|s| s.as_str())
     |                      ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::String::as_str`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `i64` may wrap around the value
    --> src/features/chat/service.rs:1486:39
     |
1486 |               let tool_call_timestamp = std::time::SystemTime::now()
     |  _______________________________________^
1487 | |                 .duration_since(std::time::UNIX_EPOCH)
1488 | |                 .unwrap()
1489 | |                 .as_secs() as i64;
     | |_________________________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: variables can be used directly in the `format!` string
    --> src/features/chat/service.rs:1538:61
     |
1538 | ...                   return Err(AppError::Validation(format!("Invalid arguments: {}", e)));
     |                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
     |
1538 -                             return Err(AppError::Validation(format!("Invalid arguments: {}", e)));
1538 +                             return Err(AppError::Validation(format!("Invalid arguments: {e}")));
     |

error: use Option::map_or_else instead of an if let/else
    --> src/features/chat/service.rs:1592:41
     |
1592 | / ...                   if let Some(text) = extracted_text {
1593 | | ...                       Ok(serde_json::Value::String(text))
1594 | | ...                   } else {
1595 | | ...                       Ok(value)
1596 | | ...                   }
     | |_______________________^ help: try: `extracted_text.map_or_else(|| Ok(value), |text| Ok(serde_json::Value::String(text)))`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else

error: variables can be used directly in the `format!` string
    --> src/features/chat/service.rs:1598:69
     |
1598 |   ...                   Err(e) => Err(AppError::Generic(format!(
     |  _______________________________________________________^
1599 | | ...                       "Failed to serialize tool response: {}",
1600 | | ...                       e
1601 | | ...                   ))),
     | |_______________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
    --> src/features/chat/service.rs:1604:65
     |
1604 | ...                   Ok(Err(e)) => Err(AppError::Generic(format!("Tool execution failed: {}", e))),
     |                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
     |
1604 -                             Ok(Err(e)) => Err(AppError::Generic(format!("Tool execution failed: {}", e))),
1604 +                             Ok(Err(e)) => Err(AppError::Generic(format!("Tool execution failed: {e}"))),
     |

error: use Option::map_or_else instead of an if let/else
    --> src/features/chat/service.rs:1617:37
     |
1617 |                   let connection_id = match tool_to_connection.get(&tool_call.function.name) {
     |  _____________________________________^
1618 | |                     Some(id) => id,
1619 | |                     None => {
...    |
1623 | |                 };
     | |_________________^ help: try: `tool_to_connection.get(&tool_call.function.name).map_or_else(|| &"".to_string(), |id| id)`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else

error: empty String is being created manually
    --> src/features/chat/service.rs:1621:26
     |
1621 |                         &"".to_string() // Dummy value, will be caught below
     |                          ^^^^^^^^^^^^^^ help: consider using: `String::new()`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_string_new

error: use Option::map_or_else instead of an if let/else
    --> src/features/chat/service.rs:1659:37
     |
1659 | / ...                   match result {
1660 | | ...                       Ok(r) => r,
1661 | | ...                       Err(_) => Err(AppError::Generic(
1662 | | ...                           "Tool execution timed out after 60 seconds".to_string(),
1663 | | ...                       )),
1664 | | ...                   }
     | |_______________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
     |
1659 ~                                     result.map_or_else(|_| Err(AppError::Generic(
1660 +                                             "Tool execution timed out after 60 seconds".to_string(),
1661 +                                         )), |r| r)
     |

error: redundant clone
    --> src/features/chat/service.rs:1830:44
     |
1830 |                     content: system_message.clone(),
     |                                            ^^^^^^^^ help: remove this
     |
note: this value is dropped without further use
    --> src/features/chat/service.rs:1830:30
     |
1830 |                     content: system_message.clone(),
     |                              ^^^^^^^^^^^^^^
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone

error: this function's return value is unnecessarily wrapped by `Result`
    --> src/features/chat/service.rs:1813:5
     |
1813 | /     fn prepare_messages(
1814 | |         &self,
1815 | |         existing_messages: &[Message],
1816 | |         workspace_settings: &WorkspaceSettings,
...    |
1986 | |         Ok(api_messages)
1987 | |     }
     | |_____^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unnecessary_wraps
help: remove `Result` from the return type...
     |
1820 -     ) -> Result<Vec<ChatMessage>, AppError> {
1820 +     ) -> std::vec::Vec<models::llm_types::ChatMessage> {
     |
help: ...and then change returning expressions
     |
1986 -         Ok(api_messages)
1986 +         api_messages
     |

error: use Option::map_or instead of an if let/else
    --> src/features/chat/service.rs:1845:33
     |
1845 |                       let files = if let Some(metadata) = &msg.metadata {
     |  _________________________________^
1846 | |                         if let Ok(meta_json) = serde_json::from_str::<serde_json::Value>(metadata) {
1847 | |                             // Try new format first (files array)
1848 | |                             if let Some(file_array) =
...    |
1874 | |                         None
1875 | |                     };
     | |_____________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
     |
1845 ~                     let files = msg.metadata.as_ref().map_or(None, |metadata| if let Ok(meta_json) = serde_json::from_str::<serde_json::Value>(metadata) {
1846 +                             // Try new format first (files array)
1847 +                             if let Some(file_array) =
1848 +                                 meta_json.get("files").and_then(|f| f.as_array())
1849 +                             {
1850 +                                 Some(
1851 +                                     file_array
1852 +                                         .iter()
1853 +                                         .filter_map(|f| f.as_str().map(|s| s.to_string()))
1854 +                                         .collect::<Vec<String>>(),
1855 +                                 )
1856 +                             }
1857 +                             // Fallback to old format (images only)
1858 +                             else if let Some(imgs) =
1859 +                                 meta_json.get("images").and_then(|i| i.as_array())
1860 +                             {
1861 +                                 Some(
1862 +                                     imgs.iter()
1863 +                                         .filter_map(|i| i.as_str().map(|s| s.to_string()))
1864 +                                         .collect::<Vec<String>>(),
1865 +                                 )
1866 +                             } else {
1867 +                                 None
1868 +                             }
1869 +                         } else {
1870 +                             None
1871 ~                         });
     |

error: use Option::map_or instead of an if let/else
    --> src/features/chat/service.rs:1846:25
     |
1846 | /                         if let Ok(meta_json) = serde_json::from_str::<serde_json::Value>(metadata) {
1847 | |                             // Try new format first (files array)
1848 | |                             if let Some(file_array) =
1849 | |                                 meta_json.get("files").and_then(|f| f.as_array())
...    |
1871 | |                             None
1872 | |                         }
     | |_________________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
     |
1846 ~                         serde_json::from_str::<serde_json::Value>(metadata).map_or(None, |meta_json| if let Some(file_array) =
1847 +                                 meta_json.get("files").and_then(|f| f.as_array())
1848 +                             {
1849 +                                 Some(
1850 +                                     file_array
1851 +                                         .iter()
1852 +                                         .filter_map(|f| f.as_str().map(|s| s.to_string()))
1853 +                                         .collect::<Vec<String>>(),
1854 +                                 )
1855 +                             }
1856 +                             // Fallback to old format (images only)
1857 +                             else if let Some(imgs) =
1858 +                                 meta_json.get("images").and_then(|i| i.as_array())
1859 +                             {
1860 +                                 Some(
1861 +                                     imgs.iter()
1862 +                                         .filter_map(|i| i.as_str().map(|s| s.to_string()))
1863 +                                         .collect::<Vec<String>>(),
1864 +                                 )
1865 +                             } else {
1866 +                                 None
1867 +                             })
     |

error: use Option::map_or_else instead of an if let/else
    --> src/features/chat/service.rs:1848:29
     |
1848 | / ...                   if let Some(file_array) =
1849 | | ...                       meta_json.get("files").and_then(|f| f.as_array())
1850 | | ...                   {
1851 | | ...                       Some(
...    |
1868 | | ...                       None
1869 | | ...                   }
     | |_______________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
     |
1848 ~                             meta_json.get("files").and_then(|f| f.as_array()).map_or_else(|| if let Some(imgs) =
1849 +                                 meta_json.get("images").and_then(|i| i.as_array())
1850 +                             {
1851 +                                 Some(
1852 +                                     imgs.iter()
1853 +                                         .filter_map(|i| i.as_str().map(|s| s.to_string()))
1854 +                                         .collect::<Vec<String>>(),
1855 +                                 )
1856 +                             } else {
1857 +                                 None
1858 +                             }, |file_array| Some(
1859 +                                     file_array
1860 +                                         .iter()
1861 +                                         .filter_map(|f| f.as_str().map(|s| s.to_string()))
1862 +                                         .collect::<Vec<String>>(),
1863 +                                 ))
     |

error: redundant closure
    --> src/features/chat/service.rs:1854:72
     |
1854 | ...                   .filter_map(|f| f.as_str().map(|s| s.to_string()))
     |                                                      ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: manual implementation of `Option::map`
    --> src/features/chat/service.rs:1859:34
     |
1859 |   ...                   else if let Some(imgs) =
     |  ____________________________^
1860 | | ...                       meta_json.get("images").and_then(|i| i.as_array())
1861 | | ...                   {
1862 | | ...                       Some(
...    |
1868 | | ...                       None
1869 | | ...                   }
     | |_______________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_map
     = note: `-D clippy::manual-map` implied by `-D warnings`
     = help: to override `-D warnings` add `#[allow(clippy::manual_map)]`
help: try
     |
1859 ~                             else { meta_json.get("images").and_then(|i| i.as_array()).map(|imgs| imgs.iter()
1860 +                                         .filter_map(|i| i.as_str().map(|s| s.to_string()))
1861 +                                         .collect::<Vec<String>>()) }
     |

error: redundant closure
    --> src/features/chat/service.rs:1864:72
     |
1864 | ...                   .filter_map(|i| i.as_str().map(|s| s.to_string()))
     |                                                      ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: use Option::map_or_else instead of an if let/else
    --> src/features/chat/service.rs:1877:35
     |
1877 |                       let content = if let Some(file_list) = files {
     |  ___________________________________^
1878 | |                         if file_list.is_empty() {
1879 | |                             UserContent::Text(msg.content.clone())
1880 | |                         } else {
...    |
1913 | |                         UserContent::Text(msg.content.clone())
1914 | |                     };
     | |_____________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
     |
1877 ~                     let content = files.map_or_else(|| UserContent::Text(msg.content.clone()), |file_list| if file_list.is_empty() {
1878 +                             UserContent::Text(msg.content.clone())
1879 +                         } else {
1880 +                             let mut parts = Vec::new();
1881 +                             // Text part
1882 +                             if !msg.content.is_empty() {
1883 +                                 parts.push(ContentPart::Text {
1884 +                                     text: msg.content.clone(),
1885 +                                 });
1886 +                             }
1887 +                             // File parts
1888 +                             for file_path in file_list {
1889 +                                 let (file_content, actual_mime) =
1890 +                                     self.load_file_content(&file_path).unwrap_or((
1891 +                                         file_path.clone(),
1892 +                                         "application/octet-stream".to_string(),
1893 +                                     ));
1894 + 
1895 +                                 // Check if it's an image to maintain backward compatibility
1896 +                                 if actual_mime.starts_with("image/") {
1897 +                                     parts.push(ContentPart::ImageUrl {
1898 +                                         image_url: ImageUrl { url: file_content },
1899 +                                     });
1900 +                                 } else {
1901 +                                     parts.push(ContentPart::FileUrl {
1902 +                                         file_url: FileUrl {
1903 +                                             url: file_content,
1904 +                                             mime_type: actual_mime,
1905 +                                         },
1906 +                                     });
1907 +                                 }
1908 +                             }
1909 +                             UserContent::Parts(parts)
1910 ~                         });
     |

error: function call inside of `unwrap_or`
    --> src/features/chat/service.rs:1891:72
     |
1891 |   ...                   self.load_file_content(&file_path).unwrap_or((
     |  __________________________________________________________^
1892 | | ...                       file_path.clone(),
1893 | | ...                       "application/octet-stream".to_string(),
1894 | | ...                   ));
     | |________________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call
help: try
     |
1891 ~                                     self.load_file_content(&file_path).unwrap_or_else(|_| (
1892 +                                         file_path.clone(),
1893 +                                         "application/octet-stream".to_string(),
1894 ~                                     ));
     |

error: use Option::map_or_else instead of an if let/else
    --> src/features/chat/service.rs:1945:23
     |
1945 |           let content = if let Some(file_list) = user_files {
     |  _______________________^
1946 | |             if file_list.is_empty() {
1947 | |                 UserContent::Text(user_content.to_string())
1948 | |             } else {
...    |
1981 | |             UserContent::Text(user_content.to_string())
1982 | |         };
     | |_________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
     |
1945 ~         let content = user_files.map_or_else(|| UserContent::Text(user_content.to_string()), |file_list| if file_list.is_empty() {
1946 +                 UserContent::Text(user_content.to_string())
1947 +             } else {
1948 +                 let mut parts = Vec::new();
1949 +                 // Text part
1950 +                 if !user_content.is_empty() {
1951 +                     parts.push(ContentPart::Text {
1952 +                         text: user_content.to_string(),
1953 +                     });
1954 +                 }
1955 +                 // File parts
1956 +                 for file_path in file_list {
1957 +                     let (file_content, actual_mime) =
1958 +                         self.load_file_content(file_path).unwrap_or((
1959 +                             file_path.to_string(),
1960 +                             "application/octet-stream".to_string(),
1961 +                         ));
1962 + 
1963 +                     // Check if it's an image
1964 +                     if actual_mime.starts_with("image/") {
1965 +                         parts.push(ContentPart::ImageUrl {
1966 +                             image_url: ImageUrl { url: file_content },
1967 +                         });
1968 +                     } else {
1969 +                         parts.push(ContentPart::FileUrl {
1970 +                             file_url: FileUrl {
1971 +                                 url: file_content,
1972 +                                 mime_type: actual_mime,
1973 +                             },
1974 +                         });
1975 +                     }
1976 +                 }
1977 +                 UserContent::Parts(parts)
1978 ~             });
     |

error: function call inside of `unwrap_or`
    --> src/features/chat/service.rs:1959:59
     |
1959 |                           self.load_file_content(file_path).unwrap_or((
     |  ___________________________________________________________^
1960 | |                             file_path.to_string(),
1961 | |                             "application/octet-stream".to_string(),
1962 | |                         ));
     | |__________________________^
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call
help: try
     |
1959 ~                         self.load_file_content(file_path).unwrap_or_else(|_| (
1960 +                             file_path.to_string(),
1961 +                             "application/octet-stream".to_string(),
1962 ~                         ));
     |

error: casting `u64` to `i64` may wrap around the value
  --> src/features/hub/commands.rs:67:15
   |
67 |       let now = std::time::SystemTime::now()
   |  _______________^
68 | |         .duration_since(std::time::UNIX_EPOCH)
69 | |         .unwrap()
70 | |         .as_secs() as i64;
   | |_________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: casting `u64` to `i64` may wrap around the value
   --> src/features/hub/commands.rs:122:15
    |
122 |       let now = std::time::SystemTime::now()
    |  _______________^
123 | |         .duration_since(std::time::UNIX_EPOCH)
124 | |         .unwrap()
125 | |         .as_secs() as i64;
    | |_________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: this could be a `const fn`
  --> src/features/hub/mcp_config.rs:10:5
   |
10 | /     pub fn new() -> Self {
11 | |         Self
12 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
10 |     pub const fn new() -> Self {
   |         +++++

error: item in documentation is missing backticks
  --> src/features/hub/mcp_config.rs:15:49
   |
15 |     /// If a variable is not provided, convert {variable_name} to {{variable_name}} format
   |                                                 ^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
   = note: `-D clippy::doc-markdown` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::doc_markdown)]`
help: try
   |
15 -     /// If a variable is not provided, convert {variable_name} to {{variable_name}} format
15 +     /// If a variable is not provided, convert {`variable_name`} to {{variable_name}} format
   |

error: item in documentation is missing backticks
  --> src/features/hub/mcp_config.rs:15:69
   |
15 |     /// If a variable is not provided, convert {variable_name} to {{variable_name}} format
   |                                                                     ^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
help: try
   |
15 -     /// If a variable is not provided, convert {variable_name} to {{variable_name}} format
15 +     /// If a variable is not provided, convert {variable_name} to {{`variable_name`}} format
   |

error: unused `self` argument
  --> src/features/hub/mcp_config.rs:18:9
   |
18 |         &self,
   |         ^^^^^
   |
   = help: consider refactoring to an associated function
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: use Option::map_or_else instead of an if let/else
  --> src/features/hub/mcp_config.rs:31:21
   |
31 | /                     if let Some(var_name_match) = caps.get(1) {
32 | |                         let var_name = var_name_match.as_str();
33 | |                         // If variable is provided, replace it with the value
34 | |                         if let Some(value) = variables.get(var_name) {
...  |
44 | |                             .unwrap_or_default()
45 | |                     }
   | |_____________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
   |
31 ~                     caps.get(1).map_or_else(|| caps.get(0)
32 +                             .map(|m| m.as_str().to_string())
33 +                             .unwrap_or_default(), |var_name_match| {
34 +                         let var_name = var_name_match.as_str();
35 +                         // If variable is provided, replace it with the value
36 +                         if let Some(value) = variables.get(var_name) {
37 +                             value.clone()
38 +                         } else {
39 +                             // Otherwise, convert to {{variable_name}} format
40 +                             format!("{{{{{var_name}}}}}")
41 +                         }
42 +                     })
   |

error: use Option::map_or_else instead of an if let/else
  --> src/features/hub/mcp_config.rs:34:25
   |
34 | /                         if let Some(value) = variables.get(var_name) {
35 | |                             value.clone()
36 | |                         } else {
...  |
39 | |                         }
   | |_________________________^ help: try: `variables.get(var_name).map_or_else(|| format!("{{{{{var_name}}}}}"), |value| value.clone())`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else

error: item in documentation is missing backticks
   --> src/features/hub/mcp_config.rs:103:39
    |
103 |     /// Converts hub config format to MCPServerConnection format
    |                                       ^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
help: try
    |
103 -     /// Converts hub config format to MCPServerConnection format
103 +     /// Converts hub config format to `MCPServerConnection` format
    |

error: item in documentation is missing backticks
   --> src/features/hub/mcp_config.rs:104:32
    |
104 |     /// Returns (url, headers, env_vars, runtime_path)
    |                                ^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
help: try
    |
104 -     /// Returns (url, headers, env_vars, runtime_path)
104 +     /// Returns (url, headers, `env_vars`, runtime_path)
    |

error: item in documentation is missing backticks
   --> src/features/hub/mcp_config.rs:104:42
    |
104 |     /// Returns (url, headers, env_vars, runtime_path)
    |                                          ^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
help: try
    |
104 -     /// Returns (url, headers, env_vars, runtime_path)
104 +     /// Returns (url, headers, env_vars, `runtime_path`)
    |

error: unused `self` argument
   --> src/features/hub/mcp_config.rs:106:9
    |
106 |         &self,
    |         ^^^^^
    |
    = help: consider refactoring to an associated function
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: variables can be used directly in the `format!` string
   --> src/features/hub/mcp_config.rs:140:35
    |
140 |                       AppError::Hub(format!(
    |  ___________________________________^
141 | |                         "Missing 'url' in {} MCP server config",
142 | |                         server_type
143 | |                     ))
    | |_____________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
  --> src/features/hub/service.rs:40:41
   |
40 |             Err(e) => Err(AppError::Hub(format!("Failed to fetch hub index: {}", e))),
   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
40 -             Err(e) => Err(AppError::Hub(format!("Failed to fetch hub index: {}", e))),
40 +             Err(e) => Err(AppError::Hub(format!("Failed to fetch hub index: {e}"))),
   |

error: temporary with significant `Drop` can be early dropped
  --> src/features/hub/service.rs:63:13
   |
62 |       fn get_from_cache(&self) -> Option<HubIndex> {
   |  __________________________________________________-
63 | |         let cache = self.cached_index.read().ok()?;
   | |             ^^^^^
64 | |         let cached = cache.as_ref()?;
...  |
72 | |     }
   | |_____- temporary `cache` is currently being dropped at the end of its contained scope
   |
   = note: this might lead to unnecessary resource contention
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#significant_drop_tightening
help: merge the temporary construction with its single usage
   |
63 ~         
64 +         let cached = self.cached_index.read().ok()?.;
65 ~         
   |

error: variables can be used directly in the `format!` string
  --> src/features/hub/service.rs:86:26
   |
86 |             .map_err(|e| format!("HTTP request failed: {}", e))?;
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
86 -             .map_err(|e| format!("HTTP request failed: {}", e))?;
86 +             .map_err(|e| format!("HTTP request failed: {e}"))?;
   |

error: variables can be used directly in the `format!` string
  --> src/features/hub/service.rs:95:26
   |
95 |             .map_err(|e| format!("Failed to read response: {}", e))?;
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
95 -             .map_err(|e| format!("Failed to read response: {}", e))?;
95 +             .map_err(|e| format!("Failed to read response: {e}"))?;
   |

error: variables can be used directly in the `format!` string
  --> src/features/hub/service.rs:97:54
   |
97 |         serde_json::from_str(&json_text).map_err(|e| format!("Failed to parse JSON: {}", e))
   |                                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
97 -         serde_json::from_str(&json_text).map_err(|e| format!("Failed to parse JSON: {}", e))
97 +         serde_json::from_str(&json_text).map_err(|e| format!("Failed to parse JSON: {e}"))
   |

error: variables can be used directly in the `format!` string
   --> src/features/hub/service.rs:106:40
    |
106 |             .map_err(|e| AppError::Hub(format!("Failed to refresh hub index: {}", e)))?;
    |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
106 -             .map_err(|e| AppError::Hub(format!("Failed to refresh hub index: {}", e)))?;
106 +             .map_err(|e| AppError::Hub(format!("Failed to refresh hub index: {e}")))?;
    |

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/commands.rs:16:12
   |
16 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
16 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/commands.rs:33:35
   |
33 | pub fn get_llm_connections(state: State<'_, AppState>) -> Result<Vec<LLMConnection>, AppError> {
   |                                   ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
33 | pub fn get_llm_connections(state: &State<'_, AppState>) -> Result<Vec<LLMConnection>, AppError> {
   |                                   +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/commands.rs:51:12
   |
51 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
51 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/commands.rs:69:49
   |
69 | pub fn delete_llm_connection(id: String, state: State<'_, AppState>) -> Result<(), AppError> {
   |                                                 ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
69 | pub fn delete_llm_connection(id: String, state: &State<'_, AppState>) -> Result<(), AppError> {
   |                                                 +

error: this could be a `const fn`
  --> src/features/llm_connection/repository.rs:31:5
   |
31 | /     pub fn new(app: Arc<AppHandle>) -> Self {
32 | |         Self { app }
33 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
31 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casting `u64` to `i64` may wrap around the value
   --> src/features/llm_connection/repository.rs:112:19
    |
112 |           let now = std::time::SystemTime::now()
    |  ___________________^
113 | |             .duration_since(std::time::UNIX_EPOCH)
114 | |             .unwrap()
115 | |             .as_secs() as i64;
    | |_____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: casts from `bool` to `i64` can be expressed infallibly using `From`
   --> src/features/llm_connection/repository.rs:169:25
    |
169 |                 params![enabled as i64, now, id],
    |                         ^^^^^^^^^^^^^^
    |
    = help: an `as` cast can become silently lossy if the types change in the future
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_lossless
    = note: `-D clippy::cast-lossless` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::cast_lossless)]`
help: use `i64::from` instead
    |
169 -                 params![enabled as i64, now, id],
169 +                 params![i64::from(enabled), now, id],
    |

error: casting `u64` to `i64` may wrap around the value
  --> src/features/llm_connection/service.rs:26:19
   |
26 |           let now = std::time::SystemTime::now()
   |  ___________________^
27 | |             .duration_since(std::time::UNIX_EPOCH)
28 | |             .unwrap()
29 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/service.rs:59:13
   |
59 |         id: String,
   |             ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/service.rs:60:15
   |
60 |         name: Option<String>,
   |               ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
60 |         name: Option<&String>,
   |                      +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/service.rs:61:19
   |
61 |         base_url: Option<String>,
   |                   ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
61 |         base_url: Option<&String>,
   |                          +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/service.rs:62:19
   |
62 |         provider: Option<String>,
   |                   ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
62 |         provider: Option<&String>,
   |                          +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/service.rs:63:18
   |
63 |         api_key: Option<String>,
   |                  ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
63 |         api_key: Option<&String>,
   |                         +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/service.rs:64:22
   |
64 |         models_json: Option<String>,
   |                      ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
64 |         models_json: Option<&String>,
   |                             +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/service.rs:65:24
   |
65 |         default_model: Option<String>,
   |                        ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
65 |         default_model: Option<&String>,
   |                               +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/llm_connection/service.rs:80:30
   |
80 |     pub fn delete(&self, id: String) -> Result<(), AppError> {
   |                              ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this function has too many arguments (8/7)
  --> src/features/mcp_connection/commands.rs:7:1
   |
7  | / pub fn create_mcp_server_connection(
8  | |     id: String,
9  | |     name: String,
10 | |     url: String,
...  |
15 | |     state: State<'_, AppState>,
16 | | ) -> Result<MCPServerConnection, AppError> {
   | |__________________________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/commands.rs:15:12
   |
15 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
15 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/commands.rs:25:12
   |
25 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
25 |     state: &State<'_, AppState>,
   |            +

error: this function has too many arguments (8/7)
  --> src/features/mcp_connection/commands.rs:34:1
   |
34 | / pub fn update_mcp_server_connection(
35 | |     id: String,
36 | |     name: Option<String>,
37 | |     url: Option<String>,
...  |
42 | |     state: State<'_, AppState>,
43 | | ) -> Result<(), AppError> {
   | |_________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/commands.rs:42:12
   |
42 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
42 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/commands.rs:56:12
   |
56 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
56 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/commands.rs:67:12
   |
67 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
67 |     state: &State<'_, AppState>,
   |            +

error: this function has too many arguments (8/7)
  --> src/features/mcp_connection/repository.rs:11:5
   |
11 | /     fn update(
12 | |         &self,
13 | |         id: &str,
14 | |         name: Option<&str>,
...  |
19 | |         runtime_path: Option<&str>,
20 | |     ) -> Result<(), AppError>;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this could be a `const fn`
  --> src/features/mcp_connection/repository.rs:36:5
   |
36 | /     pub fn new(app: Arc<AppHandle>) -> Self {
37 | |         Self { app }
38 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
36 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casting `u64` to `i64` may wrap around the value
   --> src/features/mcp_connection/repository.rs:120:19
    |
120 |           let now = std::time::SystemTime::now()
    |  ___________________^
121 | |             .duration_since(std::time::UNIX_EPOCH)
122 | |             .unwrap()
123 | |             .as_secs() as i64;
    | |_____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: casting `u64` to `i64` may wrap around the value
   --> src/features/mcp_connection/repository.rs:178:19
    |
178 |           let now = std::time::SystemTime::now()
    |  ___________________^
179 | |             .duration_since(std::time::UNIX_EPOCH)
180 | |             .unwrap()
181 | |             .as_secs() as i64;
    | |_____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: this function has too many arguments (8/7)
  --> src/features/mcp_connection/service.rs:15:5
   |
15 | /     pub fn create(
16 | |         &self,
17 | |         id: String,
18 | |         name: String,
...  |
23 | |         runtime_path: Option<String>,
24 | |     ) -> Result<MCPServerConnection, AppError> {
   | |______________________________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: casting `u64` to `i64` may wrap around the value
  --> src/features/mcp_connection/service.rs:25:19
   |
25 |           let now = std::time::SystemTime::now()
   |  ___________________^
26 | |             .duration_since(std::time::UNIX_EPOCH)
27 | |             .unwrap()
28 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: this function has too many arguments (8/7)
  --> src/features/mcp_connection/service.rs:57:5
   |
57 | /     pub fn update(
58 | |         &self,
59 | |         id: String,
60 | |         name: Option<String>,
...  |
65 | |         runtime_path: Option<String>,
66 | |     ) -> Result<(), AppError> {
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:59:13
   |
59 |         id: String,
   |             ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:60:15
   |
60 |         name: Option<String>,
   |               ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
60 |         name: Option<&String>,
   |                      +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:61:14
   |
61 |         url: Option<String>,
   |              ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
61 |         url: Option<&String>,
   |                     +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:62:17
   |
62 |         r#type: Option<String>,
   |                 ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
62 |         r#type: Option<&String>,
   |                        +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:63:18
   |
63 |         headers: Option<String>,
   |                  ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
63 |         headers: Option<&String>,
   |                         +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:64:19
   |
64 |         env_vars: Option<String>,
   |                   ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
64 |         env_vars: Option<&String>,
   |                          +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:65:23
   |
65 |         runtime_path: Option<String>,
   |                       ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
65 |         runtime_path: Option<&String>,
   |                              +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:80:13
   |
80 |         id: String,
   |             ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:81:17
   |
81 |         status: String,
   |                 ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:82:21
   |
82 |         tools_json: Option<String>,
   |                     ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
82 |         tools_json: Option<&String>,
   |                            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:83:24
   |
83 |         error_message: Option<String>,
   |                        ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
83 |         error_message: Option<&String>,
   |                               +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/mcp_connection/service.rs:93:30
   |
93 |     pub fn delete(&self, id: String) -> Result<(), AppError> {
   |                              ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this function has too many arguments (9/7)
  --> src/features/message/commands.rs:7:1
   |
7  | / pub fn create_message(
8  | |     id: String,
9  | |     chat_id: String,
10 | |     role: String,
...  |
16 | |     state: State<'_, AppState>,
17 | | ) -> Result<Message, AppError> {
   | |______________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/commands.rs:16:12
   |
16 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
16 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/commands.rs:27:30
   |
27 | pub fn get_messages(chat_id: String, state: State<'_, AppState>) -> Result<Vec<Message>, AppError> {
   |                              ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/commands.rs:27:45
   |
27 | pub fn get_messages(chat_id: String, state: State<'_, AppState>) -> Result<Vec<Message>, AppError> {
   |                                             ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
27 | pub fn get_messages(chat_id: String, state: &State<'_, AppState>) -> Result<Vec<Message>, AppError> {
   |                                             +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/commands.rs:38:12
   |
38 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
38 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/commands.rs:50:12
   |
50 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
50 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/commands.rs:59:32
   |
59 | pub fn cancel_message(chat_id: String, state: State<'_, AppState>) -> Result<(), AppError> {
   |                                ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/commands.rs:59:47
   |
59 | pub fn cancel_message(chat_id: String, state: State<'_, AppState>) -> Result<(), AppError> {
   |                                               ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
59 | pub fn cancel_message(chat_id: String, state: &State<'_, AppState>) -> Result<(), AppError> {
   |                                               +

error: this could be a `const fn`
  --> src/features/message/emitter.rs:14:5
   |
14 | /     pub fn new(app: AppHandle) -> Self {
15 | |         Self { app }
16 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
14 |     pub const fn new(app: AppHandle) -> Self {
   |         +++++

error: this could be a `const fn`
  --> src/features/message/repository.rs:28:5
   |
28 | /     pub fn new(app: Arc<AppHandle>) -> Self {
29 | |         Self { app }
30 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
28 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casting `u64` to `i64` may wrap around the value
  --> src/features/message/service.rs:28:13
   |
28 | /             std::time::SystemTime::now()
29 | |                 .duration_since(std::time::UNIX_EPOCH)
30 | |                 .unwrap()
31 | |                 .as_secs() as i64
   | |_________________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/service.rs:60:13
   |
60 |         id: String,
   |             ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/service.rs:61:18
   |
61 |         content: String,
   |                  ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/service.rs:62:20
   |
62 |         reasoning: Option<String>,
   |                    ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
62 |         reasoning: Option<&String>,
   |                           +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/service.rs:69:39
   |
69 |     pub fn update_metadata(&self, id: String, metadata: Option<String>) -> Result<(), AppError> {
   |                                       ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/service.rs:69:57
   |
69 |     pub fn update_metadata(&self, id: String, metadata: Option<String>) -> Result<(), AppError> {
   |                                                         ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
69 |     pub fn update_metadata(&self, id: String, metadata: Option<&String>) -> Result<(), AppError> {
   |                                                                +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/service.rs:73:30
   |
73 |     pub fn delete(&self, id: String) -> Result<(), AppError> {
   |                              ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/service.rs:79:18
   |
79 |         chat_id: String,
   |                  ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/message/service.rs:80:21
   |
80 |         message_id: String,
   |                     ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/prompt/commands.rs:11:12
   |
11 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
11 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/prompt/commands.rs:20:27
   |
20 | pub fn get_prompts(state: State<'_, AppState>) -> Result<Vec<Prompt>, AppError> {
   |                           ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
20 | pub fn get_prompts(state: &State<'_, AppState>) -> Result<Vec<Prompt>, AppError> {
   |                           +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/prompt/commands.rs:32:12
   |
32 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
32 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/prompt/commands.rs:41:41
   |
41 | pub fn delete_prompt(id: String, state: State<'_, AppState>) -> Result<(), AppError> {
   |                                         ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
41 | pub fn delete_prompt(id: String, state: &State<'_, AppState>) -> Result<(), AppError> {
   |                                         +

error: this could be a `const fn`
  --> src/features/prompt/repository.rs:21:5
   |
21 | /     pub fn new(app: Arc<AppHandle>) -> Self {
22 | |         Self { app }
23 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
21 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casting `u64` to `i64` may wrap around the value
  --> src/features/prompt/repository.rs:82:19
   |
82 |           let now = std::time::SystemTime::now()
   |  ___________________^
83 | |             .duration_since(std::time::UNIX_EPOCH)
84 | |             .unwrap()
85 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: casting `u64` to `i64` may wrap around the value
  --> src/features/prompt/service.rs:16:19
   |
16 |           let now = std::time::SystemTime::now()
   |  ___________________^
17 | |             .duration_since(std::time::UNIX_EPOCH)
18 | |             .unwrap()
19 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: this argument is passed by value, but not consumed in the function body
  --> src/features/prompt/service.rs:44:13
   |
44 |         id: String,
   |             ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/prompt/service.rs:45:15
   |
45 |         name: Option<String>,
   |               ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
45 |         name: Option<&String>,
   |                      +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/prompt/service.rs:46:18
   |
46 |         content: Option<String>,
   |                  ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
46 |         content: Option<&String>,
   |                         +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/prompt/service.rs:52:30
   |
52 |     pub fn delete(&self, id: String) -> Result<(), AppError> {
   |                              ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this could be a `const fn`
  --> src/features/prompt/template_service.rs:11:5
   |
11 | /     pub fn new() -> Self {
12 | |         Self
13 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
11 |     pub const fn new() -> Self {
   |         +++++

error: variables can be used directly in the `format!` string
  --> src/features/prompt/template_service.rs:17:19
   |
17 |         let url = format!("{}/{}", HUB_BASE_URL, path);
   |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
17 -         let url = format!("{}/{}", HUB_BASE_URL, path);
17 +         let url = format!("{HUB_BASE_URL}/{path}");
   |

error: variables can be used directly in the `format!` string
  --> src/features/prompt/template_service.rs:19:38
   |
19 |             AppError::PromptTemplate(format!("Failed to fetch template from {}: {}", url, e))
   |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
19 -             AppError::PromptTemplate(format!("Failed to fetch template from {}: {}", url, e))
19 +             AppError::PromptTemplate(format!("Failed to fetch template from {url}: {e}"))
   |

error: variables can be used directly in the `format!` string
  --> src/features/prompt/template_service.rs:31:38
   |
31 |             AppError::PromptTemplate(format!("Failed to read response from {}: {}", url, e))
   |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
31 -             AppError::PromptTemplate(format!("Failed to read response from {}: {}", url, e))
31 +             AppError::PromptTemplate(format!("Failed to read response from {url}: {e}"))
   |

error: this function's return value is unnecessarily wrapped by `Result`
  --> src/features/prompt/template_service.rs:38:5
   |
38 | /     pub fn parse_markdown_template(
39 | |         &self,
40 | |         markdown: &str,
41 | |     ) -> Result<ParsedPromptTemplate, AppError> {
...  |
59 | |         })
60 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unnecessary_wraps
help: remove `Result` from the return type...
   |
41 -     ) -> Result<ParsedPromptTemplate, AppError> {
41 +     ) -> features::prompt::models::ParsedPromptTemplate {
   |
help: ...and then change returning expressions
   |
54 ~         ParsedPromptTemplate {
55 +             title: title.unwrap_or_else(|| "Untitled".to_string()),
56 +             description,
57 +             content,
58 +             variables,
59 +         }
   |

error: unused `self` argument
  --> src/features/prompt/template_service.rs:63:22
   |
63 |     fn extract_title(&self, markdown: &str) -> Option<String> {
   |                      ^^^^^
   |
   = help: consider refactoring to an associated function
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: unused `self` argument
  --> src/features/prompt/template_service.rs:78:28
   |
78 |     fn extract_description(&self, markdown: &str) -> String {
   |                            ^^^^^
   |
   = help: consider refactoring to an associated function
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: unused `self` argument
   --> src/features/prompt/template_service.rs:107:31
    |
107 |     fn extract_prompt_content(&self, markdown: &str) -> String {
    |                               ^^^^^
    |
    = help: consider refactoring to an associated function
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: item in documentation is missing backticks
   --> src/features/prompt/template_service.rs:157:54
    |
157 |     /// Extract variables from content using regex {{variable_name}}
    |                                                      ^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
help: try
    |
157 -     /// Extract variables from content using regex {{variable_name}}
157 +     /// Extract variables from content using regex {{`variable_name`}}
    |

error: unused `self` argument
   --> src/features/prompt/template_service.rs:158:26
    |
158 |     fn extract_variables(&self, content: &str) -> Vec<String> {
    |                          ^^^^^
    |
    = help: consider refactoring to an associated function
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: variables can be used directly in the `format!` string
  --> src/features/runtime/node/commands.rs:49:35
   |
49 |           return Err(AppError::Node(format!(
   |  ___________________________________^
50 | |             "Version {} not found in config",
51 | |             version
52 | |         )));
   | |_________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: this argument is passed by value, but not consumed in the function body
  --> src/features/runtime/node/commands.rs:59:36
   |
59 | pub fn uninstall_node_runtime(app: AppHandle, version: String) -> Result<(), AppError> {
   |                                    ^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
59 | pub fn uninstall_node_runtime(app: &AppHandle, version: String) -> Result<(), AppError> {
   |                                    +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/runtime/node/commands.rs:59:56
   |
59 | pub fn uninstall_node_runtime(app: AppHandle, version: String) -> Result<(), AppError> {
   |                                                        ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: variables can be used directly in the `format!` string
  --> src/features/runtime/node/service.rs:75:13
   |
75 |             format!("v{}", full_version)
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
75 -             format!("v{}", full_version)
75 +             format!("v{full_version}")
   |

error: variables can be used directly in the `format!` string
  --> src/features/runtime/node/service.rs:84:39
   |
84 |               return Err(AppError::Node(format!(
   |  _______________________________________^
85 | |                 "Node {} not installed (dir not found)",
86 | |                 full_version
87 | |             )));
   | |_____________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/node/service.rs:152:39
    |
152 |               return Err(AppError::Node(format!(
    |  _______________________________________^
153 | |                 "FNM install failed: {}\nOutput: {}",
154 | |                 stderr, stdout
155 | |             )));
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/node/service.rs:181:39
    |
181 |             return Err(AppError::Node(format!("FNM uninstall failed: {}", stderr)));
    |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
181 -             return Err(AppError::Node(format!("FNM uninstall failed: {}", stderr)));
181 +             return Err(AppError::Node(format!("FNM uninstall failed: {stderr}")));
    |

error: variables can be used directly in the `format!` string
  --> src/features/runtime/python/commands.rs:53:37
   |
53 |           return Err(AppError::Python(format!(
   |  _____________________________________^
54 | |             "Version {} not found in config",
55 | |             version
56 | |         )));
   | |_________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: this argument is passed by value, but not consumed in the function body
  --> src/features/runtime/python/commands.rs:65:38
   |
65 | pub fn uninstall_python_runtime(app: AppHandle, version: String) -> Result<(), AppError> {
   |                                      ^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
65 | pub fn uninstall_python_runtime(app: &AppHandle, version: String) -> Result<(), AppError> {
   |                                      +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/runtime/python/commands.rs:65:58
   |
65 | pub fn uninstall_python_runtime(app: AppHandle, version: String) -> Result<(), AppError> {
   |                                                          ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:102:26
    |
102 |       Err(AppError::Python(format!(
    |  __________________________^
103 | |         "Bundled UV '{}' not found. Please ensure UV binary is downloaded.\n\
104 | |              Run: cd src-tauri && cargo build\n\
105 | |              This will trigger build.rs to download UV binaries.",
106 | |         uv_name
107 | |     )))
    | |_____^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:155:41
    |
155 |               return Err(AppError::Python(format!(
    |  _________________________________________^
156 | |                 "Python {} directory not found",
157 | |                 full_version
158 | |             )));
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:234:13
    |
234 | /             eprintln!(
235 | |                 "UV python install failed for version {}:\nSTDOUT:\n{}\nSTDERR:\n{}",
236 | |                 full_version, stdout, stderr
237 | |             );
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:238:41
    |
238 |               return Err(AppError::Python(format!(
    |  _________________________________________^
239 | |                 "UV python install failed. Check terminal for details. Stderr: {}",
240 | |                 stderr
241 | |             )));
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:262:13
    |
262 | /             eprintln!(
263 | |                 "UV venv creation failed for version {}:\nSTDERR:\n{}",
264 | |                 full_version, stderr
265 | |             );
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:266:41
    |
266 |               return Err(AppError::Python(format!(
    |  _________________________________________^
267 | |                 "UV venv creation failed: {}",
268 | |                 stderr
269 | |             )));
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:325:13
    |
325 | /             eprintln!(
326 | |                 "UV pip install failed:\nSTDOUT:\n{}\nSTDERR:\n{}",
327 | |                 stdout, stderr
328 | |             );
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:329:41
    |
329 |               return Err(AppError::Python(format!(
    |  _________________________________________^
330 | |                 "UV pip install failed. Check terminal for details. Stderr: {}",
331 | |                 stderr
332 | |             )));
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/runtime/python/service.rs:399:9
    |
399 |         write!(temp_file, "{}", script)?;
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
399 -         write!(temp_file, "{}", script)?;
399 +         write!(temp_file, "{script}")?;
    |

error: temporary with significant `Drop` can be early dropped
  --> src/features/tool/commands.rs:61:13
   |
60 |   ) -> Result<(), AppError> {
   |  ___________________________-
61 | |     let mut connection_info = state.connection_info.lock().await;
   | |             ^^^^^^^^^^^^^^^
...  |
69 | |     Ok(())
70 | | }
   | |_- temporary `connection_info` is currently being dropped at the end of its contained scope
   |
   = note: this might lead to unnecessary resource contention
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#significant_drop_tightening
help: merge the temporary construction with its single usage
   |
61 ~     
62 +     state.connection_info.lock().await.insert(
63 +         connection_id,
64 +         (url, r#type, headers, env_vars, runtime_path),
65 +     );
66 |
67 |     // Store connection info for later use
68 ~     
   |

error: temporary with significant `Drop` can be early dropped
   --> src/features/tool/commands.rs:114:13
    |
113 |   ) -> Result<(), AppError> {
    |  ___________________________-
114 | |     let mut connection_info = state.connection_info.lock().await;
    | |             ^^^^^^^^^^^^^^^
...   |
119 | |     Ok(())
120 | | }
    | |_- temporary `connection_info` is currently being dropped at the end of its contained scope
    |
    = note: this might lead to unnecessary resource contention
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#significant_drop_tightening
help: merge the temporary construction with its single usage
    |
114 ~     
115 +     state.connection_info.lock().await.remove(&connection_id);
116 |
117 |     // Remove connection info
118 ~     
    |

error: it is more idiomatic to use `Option<&T>` instead of `&Option<T>`
  --> src/features/tool/mcp_client.rs:34:5
   |
34 |       fn parse_json_map(json_str: &Option<String>) -> Option<HashMap<String, String>> {
   |       ^                           --------------- help: change this to: `Option<&String>`
   |  _____|
   | |
35 | |         if let Some(s) = json_str {
36 | |             if let Ok(parsed) = serde_json::from_str::<serde_json::Value>(s) {
37 | |                 if let Some(obj) = parsed.as_object() {
...  |
50 | |         None
51 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#ref_option
   = note: `-D clippy::ref-option` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::ref_option)]`

error: the function has a cognitive complexity of (31/30)
  --> src/features/tool/mcp_client.rs:67:18
   |
67 |     pub async fn create_and_start_client(
   |                  ^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: you could split it up into multiple smaller functions
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cognitive_complexity
   = note: `-D clippy::cognitive-complexity` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::cognitive_complexity)]`

error: variables can be used directly in the `format!` string
  --> src/features/tool/mcp_client.rs:81:45
   |
81 |               return Err(AppError::Validation(format!(
   |  _____________________________________________^
82 | |                 "Unsupported transport type: {}. Only 'sse', 'http-streamable', 'streamable-http', and 'stdio' are supported.",
83 | |                 r#type
84 | |             )));
   | |_____________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: assigning the result of `Clone::clone()` may be inefficient
  --> src/features/tool/mcp_client.rs:92:13
   |
92 |             env_vars = custom_headers.clone();
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use `clone_from()`: `env_vars.clone_from(&custom_headers)`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#assigning_clones
   = note: `-D clippy::assigning-clones` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::assigning_clones)]`

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:107:35
    |
107 |                     let err_msg = format!("Failed to create SSE transport for {}: {}", url, e);
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
107 -                     let err_msg = format!("Failed to create SSE transport for {}: {}", url, e);
107 +                     let err_msg = format!("Failed to create SSE transport for {url}: {e}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:108:21
    |
108 |                     eprintln!("{}", err_msg);
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
108 -                     eprintln!("{}", err_msg);
108 +                     eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:134:35
    |
134 |                     let err_msg = format!("Invalid stdio URL '{}': parse error: {}", url, e);
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
134 -                     let err_msg = format!("Invalid stdio URL '{}': parse error: {}", url, e);
134 +                     let err_msg = format!("Invalid stdio URL '{url}': parse error: {e}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:135:21
    |
135 |                     eprintln!("{}", err_msg);
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
135 -                     eprintln!("{}", err_msg);
135 +                     eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:141:31
    |
141 |                 let err_msg = format!("Invalid stdio URL '{}': command cannot be empty", url);
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
141 -                 let err_msg = format!("Invalid stdio URL '{}': command cannot be empty", url);
141 +                 let err_msg = format!("Invalid stdio URL '{url}': command cannot be empty");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:142:17
    |
142 |                 eprintln!("{}", err_msg);
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
142 -                 eprintln!("{}", err_msg);
142 +                 eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:233:37
    |
233 | ...                   format!("{}.cmd", command)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
233 -                                     format!("{}.cmd", command)
233 +                                     format!("{command}.cmd")
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:277:35
    |
277 |                       let err_msg = format!(
    |  ___________________________________^
278 | |                         "Failed to create stdio transport for command '{}' with args {:?}: {}",
279 | |                         command, args, e
280 | |                     );
    | |_____________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:281:21
    |
281 |                     eprintln!("{}", err_msg);
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
281 -                     eprintln!("{}", err_msg);
281 +                     eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:291:27
    |
291 |             let err_msg = format!("Failed to start MCP client for {}: {}", url, e);
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
291 -             let err_msg = format!("Failed to start MCP client for {}: {}", url, e);
291 +             let err_msg = format!("Failed to start MCP client for {url}: {e}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:292:13
    |
292 |             eprintln!("{}", err_msg);
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
292 -             eprintln!("{}", err_msg);
292 +             eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:327:17
    |
327 |                 eprintln!("{}", err_msg);
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
327 -                 eprintln!("{}", err_msg);
327 +                 eprintln!("{err_msg}");
    |

error: this function has too many arguments (8/7)
   --> src/features/tool/mcp_client.rs:357:5
    |
357 | /     pub async fn call_tool(
358 | |         app: &AppHandle,
359 | |         url: String,
360 | |         r#type: String,
...   |
365 | |         runtime_path: Option<String>,
366 | |     ) -> Result<String, AppError> {
    | |_________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: variables can be used directly in the `format!` string
   --> src/features/tool/mcp_client.rs:396:17
    |
396 |                 eprintln!("{}", err_msg);
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
396 -                 eprintln!("{}", err_msg);
396 +                 eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
  --> src/features/tool/mcp_refresh.rs:35:17
   |
35 |                 eprintln!("Initial MCP tools refresh failed: {}", e);
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
35 -                 eprintln!("Initial MCP tools refresh failed: {}", e);
35 +                 eprintln!("Initial MCP tools refresh failed: {e}");
   |

error: variables can be used directly in the `format!` string
  --> src/features/tool/mcp_refresh.rs:45:21
   |
45 |                     eprintln!("MCP tools refresh failed: {}", e);
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
45 -                     eprintln!("MCP tools refresh failed: {}", e);
45 +                     eprintln!("MCP tools refresh failed: {e}");
   |

error: variables can be used directly in the `format!` string
  --> src/features/tool/mcp_refresh.rs:80:43
   |
80 |                         AppError::Generic(format!("Failed to serialize tools: {}", e))
   |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
80 -                         AppError::Generic(format!("Failed to serialize tools: {}", e))
80 +                         AppError::Generic(format!("Failed to serialize tools: {e}"))
   |

error: this could be a `const fn`
  --> src/features/tool/service.rs:18:5
   |
18 | /     pub fn new(
19 | |         app: AppHandle,
20 | |         mcp_connection_service: Arc<MCPConnectionService>,
21 | |         workspace_settings_service: Arc<WorkspaceSettingsService>,
...  |
28 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
18 |     pub const fn new(
   |         +++++

error: item in documentation is missing backticks
  --> src/features/tool/service.rs:30:59
   |
30 |     /// Get MCP tools for a workspace and convert them to OpenAI format
   |                                                           ^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
help: try
   |
30 -     /// Get MCP tools for a workspace and convert them to OpenAI format
30 +     /// Get MCP tools for a workspace and convert them to `OpenAI` format
   |

error: item in documentation is missing backticks
  --> src/features/tool/service.rs:31:31
   |
31 |     /// Now reads from cached tools_json in SQLite instead of calling MCP server
   |                               ^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
help: try
   |
31 -     /// Now reads from cached tools_json in SQLite instead of calling MCP server
31 +     /// Now reads from cached `tools_json` in SQLite instead of calling MCP server
   |

error: item in documentation is missing backticks
  --> src/features/tool/service.rs:31:45
   |
31 |     /// Now reads from cached tools_json in SQLite instead of calling MCP server
   |                                             ^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown
help: try
   |
31 -     /// Now reads from cached tools_json in SQLite instead of calling MCP server
31 +     /// Now reads from cached tools_json in `SQLite` instead of calling MCP server
   |

error: variables can be used directly in the `format!` string
   --> src/features/tool/service.rs:123:13
    |
123 | /             format!(
124 | |                 "Executing tool {} via connection {}",
125 | |                 tool_name, connection_id
126 | |             ),
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: casting `u128` to `u64` may truncate the value
   --> src/features/tool/service.rs:172:24
    |
172 |         let duration = start_time.elapsed().as_millis() as u64;
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
172 -         let duration = start_time.elapsed().as_millis() as u64;
172 +         let duration = u64::try_from(start_time.elapsed().as_millis());
    |

error: this argument is passed by value, but not consumed in the function body
 --> src/features/usage/commands.rs:9:12
  |
9 |     state: State<'_, AppState>,
  |            ^^^^^^^^^^^^^^^^^^^
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
  |
9 |     state: &State<'_, AppState>,
  |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/usage/commands.rs:20:15
   |
20 |     interval: String,
   |               ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/usage/commands.rs:21:12
   |
21 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
21 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/usage/commands.rs:34:12
   |
34 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
34 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/usage/commands.rs:43:27
   |
43 | pub fn clear_usage(state: State<'_, AppState>) -> Result<(), AppError> {
   |                           ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
43 | pub fn clear_usage(state: &State<'_, AppState>) -> Result<(), AppError> {
   |                           +

error: this could be a `const fn`
  --> src/features/usage/repository.rs:19:5
   |
19 | /     pub fn new(app: Arc<AppHandle>) -> Self {
20 | |         Self { app }
21 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
19 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casts from `bool` to `i32` can be expressed infallibly using `From`
  --> src/features/usage/repository.rs:47:17
   |
47 |                 stat.is_stream as i32,
   |                 ^^^^^^^^^^^^^^^^^^^^^
   |
   = help: an `as` cast can become silently lossy if the types change in the future
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_lossless
help: use `i32::from` instead
   |
47 -                 stat.is_stream as i32,
47 +                 i32::from(stat.is_stream),
   |

error: redundant closure
  --> src/features/usage/repository.rs:82:71
   |
82 |         let params_ref: Vec<&dyn rusqlite::ToSql> = params.iter().map(|p| p.as_ref()).collect();
   |                                                                       ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::convert::AsRef::as_ref`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/features/usage/repository.rs:138:71
    |
138 |         let params_ref: Vec<&dyn rusqlite::ToSql> = params.iter().map(|p| p.as_ref()).collect();
    |                                                                       ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::convert::AsRef::as_ref`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: this match arm has an identical body to the `_` wildcard arm
   --> src/features/usage/repository.rs:156:13
    |
156 | /             "hour" => 3600,
157 | |             "day" => 86400,
    | |____________^ help: try removing the arm
    |
    = help: or try changing either arm body
note: `_` wildcard arm here
   --> src/features/usage/repository.rs:158:13
    |
158 |             _ => 3600,
    |             ^^^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#match_same_arms
    = note: `-D clippy::match-same-arms` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::match_same_arms)]`

error: variables can be used directly in the `format!` string
   --> src/features/usage/repository.rs:161:25
    |
161 |           let mut query = format!(
    |  _________________________^
162 | |             "SELECT 
163 | |                 (timestamp / {0}) * {0} as bucket,
164 | |                 COUNT(*) as requests,
...   |
169 | |             interval_seconds
170 | |         );
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: redundant closure
   --> src/features/usage/repository.rs:189:71
    |
189 |         let params_ref: Vec<&dyn rusqlite::ToSql> = params.iter().map(|p| p.as_ref()).collect();
    |                                                                       ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::convert::AsRef::as_ref`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: unused `self` argument
  --> src/features/usage/service.rs:17:27
   |
17 |     pub fn calculate_cost(&self, model: &str, input_tokens: u32, output_tokens: u32) -> f64 {
   |                           ^^^^^
   |
   = help: consider refactoring to an associated function
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: casts from `u32` to `f64` can be expressed infallibly using `From`
  --> src/features/usage/service.rs:35:35
   |
35 |                 let input_cost = (input_tokens as f64 / 1_000_000.0) * input_price;
   |                                   ^^^^^^^^^^^^^^^^^^^
   |
   = help: an `as` cast can become silently lossy if the types change in the future
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_lossless
help: use `f64::from` instead
   |
35 -                 let input_cost = (input_tokens as f64 / 1_000_000.0) * input_price;
35 +                 let input_cost = (f64::from(input_tokens) / 1_000_000.0) * input_price;
   |

error: casts from `u32` to `f64` can be expressed infallibly using `From`
  --> src/features/usage/service.rs:36:36
   |
36 |                 let output_cost = (output_tokens as f64 / 1_000_000.0) * output_price;
   |                                    ^^^^^^^^^^^^^^^^^^^^
   |
   = help: an `as` cast can become silently lossy if the types change in the future
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_lossless
help: use `f64::from` instead
   |
36 -                 let output_cost = (output_tokens as f64 / 1_000_000.0) * output_price;
36 +                 let output_cost = (f64::from(output_tokens) / 1_000_000.0) * output_price;
   |

error: this argument is passed by value, but not consumed in the function body
  --> src/features/usage/service.rs:51:16
   |
51 |         model: String,
   |                ^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider changing the type to
   |
51 -         model: String,
51 +         model: &str,
   |
help: change `model.clone()` to
   |
75 -             model: model.clone(),
75 +             model: model.to_string(),
   |

error: this argument is passed by value, but not consumed in the function body
  --> src/features/usage/service.rs:52:16
   |
52 |         usage: Option<TokenUsage>,
   |                ^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
52 |         usage: Option<&TokenUsage>,
   |                       +

error: redundant clone
  --> src/features/usage/service.rs:75:25
   |
75 |             model: model.clone(),
   |                         ^^^^^^^^ help: remove this
   |
note: this value is dropped without further use
  --> src/features/usage/service.rs:75:20
   |
75 |             model: model.clone(),
   |                    ^^^^^
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/management/commands.rs:10:12
   |
10 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
10 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/management/commands.rs:34:30
   |
34 | pub fn get_workspaces(state: State<'_, AppState>) -> Result<Vec<Workspace>, AppError> {
   |                              ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
34 | pub fn get_workspaces(state: &State<'_, AppState>) -> Result<Vec<Workspace>, AppError> {
   |                              +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/management/commands.rs:46:12
   |
46 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
46 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/management/commands.rs:56:44
   |
56 | pub fn delete_workspace(id: String, state: State<'_, AppState>) -> Result<(), AppError> {
   |                                            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
56 | pub fn delete_workspace(id: String, state: &State<'_, AppState>) -> Result<(), AppError> {
   |                                            +

error: this could be a `const fn`
  --> src/features/workspace/management/repository.rs:21:5
   |
21 | /     pub fn new(app: Arc<AppHandle>) -> Self {
22 | |         Self { app }
23 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
21 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casting `u64` to `i64` may wrap around the value
  --> src/features/workspace/management/service.rs:16:26
   |
16 |           let created_at = std::time::SystemTime::now()
   |  __________________________^
17 | |             .duration_since(std::time::UNIX_EPOCH)
18 | |             .unwrap()
19 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/management/service.rs:40:30
   |
40 |     pub fn update(&self, id: String, name: String) -> Result<(), AppError> {
   |                              ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/management/service.rs:40:44
   |
40 |     pub fn update(&self, id: String, name: String) -> Result<(), AppError> {
   |                                            ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/management/service.rs:44:30
   |
44 |     pub fn delete(&self, id: String) -> Result<(), AppError> {
   |                              ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this function has too many arguments (9/7)
  --> src/features/workspace/settings/commands.rs:7:1
   |
7  | / pub fn save_workspace_settings(
8  | |     workspace_id: String,
9  | |     llm_connection_id: Option<String>,
10 | |     system_message: Option<String>,
...  |
16 | |     state: State<'_, AppState>,
17 | | ) -> Result<(), AppError> {
   | |_________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/settings/commands.rs:16:12
   |
16 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
16 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/settings/commands.rs:36:19
   |
36 |     workspace_id: String,
   |                   ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/workspace/settings/commands.rs:37:12
   |
37 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
37 |     state: &State<'_, AppState>,
   |            +

error: this could be a `const fn`
  --> src/features/workspace/settings/repository.rs:20:5
   |
20 | /     pub fn new(app: Arc<AppHandle>) -> Self {
21 | |         Self { app }
22 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
20 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: this function has too many arguments (9/7)
  --> src/features/workspace/settings/service.rs:15:5
   |
15 | /     pub fn save(
16 | |         &self,
17 | |         workspace_id: String,
18 | |         llm_connection_id: Option<String>,
...  |
24 | |         max_agent_iterations: Option<i64>,
25 | |     ) -> Result<(), AppError> {
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: casting `u64` to `i64` may wrap around the value
  --> src/features/workspace/settings/service.rs:26:19
   |
26 |           let now = std::time::SystemTime::now()
   |  ___________________^
27 | |             .duration_since(std::time::UNIX_EPOCH)
28 | |             .unwrap()
29 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: boolean to int conversion using if
  --> src/features/workspace/settings/service.rs:31:70
   |
31 |         let stream_enabled_i64: Option<i64> = stream_enabled.map(|v| if v { 1 } else { 0 });
   |                                                                      ^^^^^^^^^^^^^^^^^^^^^ help: replace with from: `i64::from(v)`
   |
   = note: `v as i64` or `v.into()` can also be valid options
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#bool_to_int_with_if

error: this could be a `const fn`
  --> src/features/workspace/mod.rs:11:5
   |
11 | /     pub fn new(
12 | |         service: Arc<management::WorkspaceService>,
13 | |         settings_service: Arc<settings::WorkspaceSettingsService>,
14 | |     ) -> Self {
...  |
19 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
11 |     pub const fn new(
   |         +++++

error: this could be a `const fn`
  --> src/features/addon/service.rs:8:5
   |
8  | /     pub fn new() -> Self {
9  | |         Self
10 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
8  |     pub const fn new() -> Self {
   |         +++++

error: unused `self` argument
  --> src/features/addon/service.rs:13:23
   |
13 |     pub fn get_config(&self) -> AddonIndex {
   |                       ^^^^^
   |
   = help: consider refactoring to an associated function
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_self

error: unnecessary `Debug` formatting in `bail!` args
  --> src/features/agent/common.rs:27:58
   |
27 |         anyhow::bail!("manifest.yaml not found in {:?}", path);
   |                                                          ^^^^
   |
   = help: use `Display` formatting and change this to `path.display()`
   = note: switching to `Display` formatting will change how the value is shown; escaped characters will no longer be escaped and surrounding quotes will be removed
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unnecessary_debug_formatting
   = note: `-D clippy::unnecessary-debug-formatting` implied by `-D warnings`
   = help: to override `-D warnings` add `#[allow(clippy::unnecessary_debug_formatting)]`

error: variables can be used directly in the `format!` string
  --> src/features/agent/common.rs:27:9
   |
27 |         anyhow::bail!("manifest.yaml not found in {:?}", path);
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
27 -         anyhow::bail!("manifest.yaml not found in {:?}", path);
27 +         anyhow::bail!("manifest.yaml not found in {path:?}");
   |

error: variables can be used directly in the `format!` string
  --> src/features/agent/downloader.rs:94:13
   |
94 |             anyhow::bail!("Git checkout failed for revision: {}", rev);
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
94 -             anyhow::bail!("Git checkout failed for revision: {}", rev);
94 +             anyhow::bail!("Git checkout failed for revision: {rev}");
   |

error: this could be a `const fn`
  --> src/features/agent/manager.rs:44:5
   |
44 | /     pub fn new(app_data_dir: PathBuf, uv_path: PathBuf) -> Self {
45 | |         Self {
46 | |             base_dir: app_data_dir,
47 | |             uv_path,
48 | |         }
49 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
44 |     pub const fn new(app_data_dir: PathBuf, uv_path: PathBuf) -> Self {
   |         +++++

error: variables can be used directly in the `format!` string
  --> src/features/agent/manager.rs:69:47
   |
69 |         let extract_dir = self.tmp_dir().join(format!("{}_extracted", hash));
   |                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
69 -         let extract_dir = self.tmp_dir().join(format!("{}_extracted", hash));
69 +         let extract_dir = self.tmp_dir().join(format!("{hash}_extracted"));
   |

error: casting `u64` to `i64` may wrap around the value
  --> src/features/agent/manager.rs:78:19
   |
78 |           let now = std::time::SystemTime::now()
   |  ___________________^
79 | |             .duration_since(std::time::UNIX_EPOCH)
80 | |             .unwrap_or_default()
81 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: redundant closure
  --> src/features/agent/manager.rs:85:45
   |
85 |                 path: zip_path.to_str().map(|s| s.to_string()),
   |                                             ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: called `Iterator::last` on a `DoubleEndedIterator`; this will needlessly iterate the entire iterator
   --> src/features/agent/manager.rs:104:25
    |
104 |           let repo_name = repo_url
    |  _________________________^
105 | |             .split('/')
106 | |             .last()
    | |______________-----^
    |                |
    |                help: try: `next_back()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#double_ended_iterator_last
    = note: `-D clippy::double-ended-iterator-last` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::double_ended_iterator_last)]`

error: casting `u64` to `i64` may wrap around the value
   --> src/features/agent/manager.rs:136:19
    |
136 |           let now = std::time::SystemTime::now()
    |  ___________________^
137 | |             .duration_since(std::time::UNIX_EPOCH)
138 | |             .unwrap_or_default()
139 | |             .as_secs() as i64;
    | |_____________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: called `map(<f>).unwrap_or(<a>)` on an `Option` value
   --> src/features/agent/manager.rs:141:28
    |
141 |         let installed_at = existing_info.map(|i| i.installed_at).unwrap_or(now);
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#map_unwrap_or
help: use `map_or(<a>, <f>)` instead
    |
141 -         let installed_at = existing_info.map(|i| i.installed_at).unwrap_or(now);
141 +         let installed_at = existing_info.map_or(now, |i| i.installed_at);
    |

error: redundant closure
   --> src/features/agent/manager.rs:146:40
    |
146 |                 revision: revision.map(|s| s.to_string()),
    |                                        ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/features/agent/manager.rs:147:40
    |
147 |                 sub_path: sub_path.map(|s| s.to_string()),
    |                                        ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: function call inside of `unwrap_or`
   --> src/features/agent/manager.rs:277:58
    |
277 | ...                   fs::read_link(&current_link).unwrap_or(current_link.clone());
    |                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `unwrap_or_else(|_| current_link.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: parameter is only used in recursion
   --> src/features/agent/manager.rs:301:28
    |
301 |     fn copy_dir_recursive(&self, src: &Path, dst: &Path) -> Result<()> {
    |                            ^^^^
    |
note: parameter used here
   --> src/features/agent/manager.rs:318:17
    |
318 |                 self.copy_dir_recursive(&entry.path(), &dest_path)?;
    |                 ^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#only_used_in_recursion
    = note: `-D clippy::only-used-in-recursion` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::only_used_in_recursion)]`

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:338:26
    |
338 |         let client_key = format!("agent:{}", agent_id);
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
338 -         let client_key = format!("agent:{}", agent_id);
338 +         let client_key = format!("agent:{agent_id}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:351:13
    |
351 |             anyhow::bail!("Agent not found: {}", agent_id);
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
351 -             anyhow::bail!("Agent not found: {}", agent_id);
351 +             anyhow::bail!("Agent not found: {agent_id}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:401:13
    |
401 |             anyhow::bail!("Agent not found: {}", agent_id);
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
401 -             anyhow::bail!("Agent not found: {}", agent_id);
401 +             anyhow::bail!("Agent not found: {agent_id}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:406:13
    |
406 |             anyhow::bail!("Persona file not found for agent: {}", agent_id);
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
406 -             anyhow::bail!("Persona file not found for agent: {}", agent_id);
406 +             anyhow::bail!("Persona file not found for agent: {agent_id}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:428:13
    |
428 |             anyhow::bail!("Agent not found: {}", agent_id);
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
428 -             anyhow::bail!("Agent not found: {}", agent_id);
428 +             anyhow::bail!("Agent not found: {agent_id}");
    |

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:454:22
    |
454 |         .map_err(|e| anyhow::anyhow!("Failed to create agent client: {}", e))?;
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
454 -         .map_err(|e| anyhow::anyhow!("Failed to create agent client: {}", e))?;
454 +         .map_err(|e| anyhow::anyhow!("Failed to create agent client: {e}"))?;
    |

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:460:26
    |
460 |             .map_err(|e| anyhow::anyhow!("Failed to list tools: {}", e))?;
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
460 -             .map_err(|e| anyhow::anyhow!("Failed to list tools: {}", e))?;
460 +             .map_err(|e| anyhow::anyhow!("Failed to list tools: {e}"))?;
    |

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:480:26
    |
480 |             .map_err(|e| anyhow::anyhow!("Failed to close client: {}", e))?;
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
480 -             .map_err(|e| anyhow::anyhow!("Failed to close client: {}", e))?;
480 +             .map_err(|e| anyhow::anyhow!("Failed to close client: {e}"))?;
    |

error: variables can be used directly in the `format!` string
   --> src/features/agent/manager.rs:490:13
    |
490 |             anyhow::bail!("Agent not found: {}", agent_id);
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
490 -             anyhow::bail!("Agent not found: {}", agent_id);
490 +             anyhow::bail!("Agent not found: {agent_id}");
    |

error: this argument is passed by value, but not consumed in the function body
  --> src/features/app_settings/commands.rs:10:12
   |
10 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
10 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/app_settings/commands.rs:20:10
   |
20 |     key: String,
   |          ^^^^^^ help: consider changing the type to: `&str`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value

error: this argument is passed by value, but not consumed in the function body
  --> src/features/app_settings/commands.rs:21:12
   |
21 |     state: State<'_, AppState>,
   |            ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
21 |     state: &State<'_, AppState>,
   |            +

error: this argument is passed by value, but not consumed in the function body
  --> src/features/app_settings/commands.rs:30:36
   |
30 | pub fn get_all_app_settings(state: State<'_, AppState>) -> Result<Vec<AppSetting>, AppError> {
   |                                    ^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
30 | pub fn get_all_app_settings(state: &State<'_, AppState>) -> Result<Vec<AppSetting>, AppError> {
   |                                    +

error: this could be a `const fn`
  --> src/features/app_settings/repository.rs:18:5
   |
18 | /     pub fn new(app: Arc<AppHandle>) -> Self {
19 | |         Self { app }
20 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
18 |     pub const fn new(app: Arc<AppHandle>) -> Self {
   |         +++++

error: casting `u64` to `i64` may wrap around the value
  --> src/features/app_settings/service.rs:16:19
   |
16 |           let now = std::time::SystemTime::now()
   |  ___________________^
17 | |             .duration_since(std::time::UNIX_EPOCH)
18 | |             .unwrap()
19 | |             .as_secs() as i64;
   | |_____________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_wrap

error: usage of wildcard import
 --> src/menu.rs:4:9
  |
4 |     use tauri::menu::*;
  |         ^^^^^^^^^^^^^^ help: try: `tauri::menu::{MenuItemBuilder, SubmenuBuilder, Submenu, PredefinedMenuItem, MenuBuilder}`
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports

error: all fields have the same postfix: `tokens`
   --> src/models/llm_types.rs:161:1
    |
161 | / pub struct TokenUsage {
162 | |     #[serde(skip_serializing_if = "Option::is_none")]
163 | |     pub prompt_tokens: Option<u32>,
164 | |     #[serde(skip_serializing_if = "Option::is_none")]
...   |
167 | |     pub total_tokens: Option<u32>,
168 | | }
    | |_^
    |
    = help: remove the postfixes
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#struct_field_names

error: function call inside of `or`
   --> src/models/llm_types.rs:217:14
    |
217 |             .or(self.thinking.clone())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| self.thinking.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: function call inside of `or`
   --> src/models/llm_types.rs:216:14
    |
216 |             .or(self.reasoning.clone())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_else(|| self.reasoning.clone())`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: usage of wildcard import
 --> src/services/llm/providers/anthropic.rs:6:5
  |
6 | use crate::models::llm_types::*;
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `crate::models::llm_types::{LLMChatResponse, ToolCall, ToolCallFunction, TokenUsage, LLMModel, LLMChatRequest, ChatMessage, UserContent, ContentPart, AssistantContent, ToolChoice}`
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports

error: this could be a `const fn`
   --> src/services/llm/providers/anthropic.rs:116:5
    |
116 | /     pub fn new(client: Arc<Client>) -> Self {
117 | |         Self { client }
118 | |     }
    | |_____^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
    |
116 |     pub const fn new(client: Arc<Client>) -> Self {
    |         +++++

error: called `Iterator::last` on a `DoubleEndedIterator`; this will needlessly iterate the entire iterator
   --> src/services/llm/providers/anthropic.rs:121:24
    |
121 |         let clean_id = model_id.split('/').last().unwrap_or(model_id);
    |                        ^^^^^^^^^^^^^^^^^^^^------
    |                                            |
    |                                            help: try: `next_back()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#double_ended_iterator_last

error: the function has a cognitive complexity of (42/30)
   --> src/services/llm/providers/anthropic.rs:132:14
    |
132 |     async fn handle_streaming(
    |              ^^^^^^^^^^^^^^^^
    |
    = help: you could split it up into multiple smaller functions
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cognitive_complexity

error: collection is never read
   --> src/services/llm/providers/anthropic.rs:172:9
    |
172 |         let mut _current_block_index: Option<u32> = None;
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#collection_is_never_read
    = note: `-D clippy::collection-is-never-read` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::collection_is_never_read)]`

error: consider adding a `;` to the last statement for consistent formatting
   --> src/services/llm/providers/anthropic.rs:182:17
    |
182 |                 futures::future::pending::<()>().await
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: add a `;` here: `futures::future::pending::<()>().await;`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#semicolon_if_nothing_returned
    = note: `-D clippy::semicolon-if-nothing-returned` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::semicolon_if_nothing_returned)]`

error: matching over `()` is more explicit
   --> src/services/llm/providers/anthropic.rs:178:14
    |
178 |              _ = async {
    |              ^ help: use `()` instead of `_`: `()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#ignored_unit_patterns

error: redundant closure
   --> src/services/llm/providers/anthropic.rs:210:72
    |
210 |                         if let Some(index) = val.get("index").and_then(|i| i.as_u64()) {
    |                                                                        ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/anthropic.rs:211:57
    |
211 | ...                   _current_block_index = Some(index as u32);
    |                                                   ^^^^^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
211 -                             _current_block_index = Some(index as u32);
211 +                             _current_block_index = Some(u32::try_from(index));
    |

error: function call inside of `unwrap_or`
   --> src/services/llm/providers/anthropic.rs:277:34
    |
277 | ...                   .unwrap_or(serde_json::json!({}))
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `unwrap_or_else(|_| serde_json::json!({}))`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: redundant closure
   --> src/services/llm/providers/anthropic.rs:309:82
    |
309 | ...                   if let Some(it) = usage.get("input_tokens").and_then(|t| t.as_u64()) {
    |                                                                            ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/anthropic.rs:310:48
    |
310 | ...                   input_tokens = it as u32;
    |                                      ^^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
310 -                                 input_tokens = it as u32;
310 +                                 input_tokens = u32::try_from(it);
    |

error: redundant closure
   --> src/services/llm/providers/anthropic.rs:317:83
    |
317 | ...                   if let Some(ot) = usage.get("output_tokens").and_then(|t| t.as_u64()) {
    |                                                                             ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/anthropic.rs:318:49
    |
318 | ...                   output_tokens = ot as u32;
    |                                       ^^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
318 -                                 output_tokens = ot as u32;
318 +                                 output_tokens = u32::try_from(ot);
    |

error: consider adding a `;` to the last statement for consistent formatting
   --> src/services/llm/providers/anthropic.rs:406:21
    |
406 |                     thinking_str.push_str(&thinking)
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: add a `;` here: `thinking_str.push_str(&thinking);`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#semicolon_if_nothing_returned

error: function call inside of `unwrap_or`
   --> src/services/llm/providers/anthropic.rs:429:26
    |
429 |                         .unwrap_or(serde_json::json!({})),
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `unwrap_or_else(|_| serde_json::json!({}))`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/anthropic.rs:566:46
    |
566 |                         system_prompt = Some(format!("{}\n\n{}", existing, content));
    |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
566 -                         system_prompt = Some(format!("{}\n\n{}", existing, content));
566 +                         system_prompt = Some(format!("{existing}\n\n{content}"));
    |

error: function call inside of `unwrap_or`
   --> src/services/llm/providers/anthropic.rs:694:34
    |
694 | ...                   .unwrap_or(serde_json::json!({}));
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `unwrap_or_else(|_| serde_json::json!({}))`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: manual implementation of `Option::map`
   --> src/services/llm/providers/anthropic.rs:726:21
    |
726 |           let tools = if let Some(req_tools) = request.tools {
    |  _____________________^
727 | |             Some(
728 | |                 req_tools
729 | |                     .into_iter()
...   |
741 | |             None
742 | |         };
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_map
help: try
    |
726 ~         let tools = request.tools.map(|req_tools| req_tools
727 +                     .into_iter()
728 +                     .map(|t| AnthropicTool {
729 +                         name: t.function.name,
730 +                         description: t.function.description,
731 +                         input_schema: t
732 +                             .function
733 +                             .parameters
734 +                             .unwrap_or(serde_json::json!({"type": "object", "properties": {}})),
735 +                     })
736 ~                     .collect());
    |

error: use Option::map_or instead of an if let/else
   --> src/services/llm/providers/anthropic.rs:726:21
    |
726 |           let tools = if let Some(req_tools) = request.tools {
    |  _____________________^
727 | |             Some(
728 | |                 req_tools
729 | |                     .into_iter()
...   |
741 | |             None
742 | |         };
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
    |
726 ~         let tools = request.tools.map_or(None, |req_tools| Some(
727 +                 req_tools
728 +                     .into_iter()
729 +                     .map(|t| AnthropicTool {
730 +                         name: t.function.name,
731 +                         description: t.function.description,
732 +                         input_schema: t
733 +                             .function
734 +                             .parameters
735 +                             .unwrap_or(serde_json::json!({"type": "object", "properties": {}})),
736 +                     })
737 +                     .collect(),
738 ~             ));
    |

error: function call inside of `unwrap_or`
   --> src/services/llm/providers/anthropic.rs:736:30
    |
736 | ...                   .unwrap_or(serde_json::json!({"type": "object", "properties": {}})),
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `unwrap_or_else(|| serde_json::json!({"type": "object", "properties": {}}))`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#or_fun_call

error: use Option::map_or instead of an if let/else
   --> src/services/llm/providers/anthropic.rs:745:27
    |
745 |           let tool_choice = if let Some(tc) = request.tool_choice {
    |  ___________________________^
746 | |             match tc {
747 | |                 ToolChoice::String(s) if s == "auto" => Some(AnthropicToolChoice::Auto),
748 | |                 ToolChoice::String(s) if s == "any" => Some(AnthropicToolChoice::Any),
...   |
755 | |             None
756 | |         };
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_if_let_else
help: try
    |
745 ~         let tool_choice = request.tool_choice.map_or(None, |tc| match tc {
746 +                 ToolChoice::String(s) if s == "auto" => Some(AnthropicToolChoice::Auto),
747 +                 ToolChoice::String(s) if s == "any" => Some(AnthropicToolChoice::Any),
748 +                 ToolChoice::Object { function, .. } => Some(AnthropicToolChoice::Tool {
749 +                     name: function.name,
750 +                 }),
751 +                 _ => None,
752 ~             });
    |

error: wildcard matches only a single variant and will also match any future added variants
   --> src/services/llm/providers/anthropic.rs:752:17
    |
752 |                 _ => None,
    |                 ^ help: try: `ToolChoice::String(_)`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#match_wildcard_for_single_variants
    = note: `-D clippy::match-wildcard-for-single-variants` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::match_wildcard_for_single_variants)]`

error: usage of wildcard import
 --> src/services/llm/providers/google.rs:4:5
  |
4 | use crate::models::llm_types::*;
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `crate::models::llm_types::{LLMModel, LLMChatResponse, TokenUsage, ToolCall, InlineData, ToolCallFunction, LLMChatRequest, ChatMessage, UserContent, ContentPart, AssistantContent}`
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports

error: this could be a `const fn`
  --> src/services/llm/providers/google.rs:19:5
   |
19 | /     pub fn new(client: Arc<Client>) -> Self {
20 | |         Self { client }
21 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
19 |     pub const fn new(client: Arc<Client>) -> Self {
   |         +++++

error: variables can be used directly in the `format!` string
  --> src/services/llm/providers/google.rs:61:9
   |
61 | /         eprintln!(
62 | |             "Uploading file to Google File API: {} (size: {} bytes, mime: {})",
63 | |             upload_url, num_bytes, mime_type
64 | |         );
   | |_________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
  --> src/services/llm/providers/google.rs:84:17
   |
84 |                 eprintln!("{}", err_msg);
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
84 -                 eprintln!("{}", err_msg);
84 +                 eprintln!("{err_msg}");
   |

error: variables can be used directly in the `format!` string
  --> src/services/llm/providers/google.rs:94:27
   |
94 |               let err_msg = format!(
   |  ___________________________^
95 | |                 "Failed to initiate upload (status {}): {}",
96 | |                 status, error_text
97 | |             );
   | |_____________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
  --> src/services/llm/providers/google.rs:98:13
   |
98 |             eprintln!("{}", err_msg);
   |             ^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
98 -             eprintln!("{}", err_msg);
98 +             eprintln!("{err_msg}");
   |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:109:17
    |
109 |                 eprintln!("{}", err_msg);
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
109 -                 eprintln!("{}", err_msg);
109 +                 eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:114:9
    |
114 |         eprintln!("Got upload session URL: {}", upload_session_url);
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
114 -         eprintln!("Got upload session URL: {}", upload_session_url);
114 +         eprintln!("Got upload session URL: {upload_session_url}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:127:17
    |
127 |                 eprintln!("{}", err_msg);
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
127 -                 eprintln!("{}", err_msg);
127 +                 eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:137:27
    |
137 |               let err_msg = format!(
    |  ___________________________^
138 | |                 "Failed to upload file bytes (status {}): {}",
139 | |                 status, error_text
140 | |             );
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:141:13
    |
141 |             eprintln!("{}", err_msg);
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
141 -             eprintln!("{}", err_msg);
141 +             eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:148:13
    |
148 |             eprintln!("{}", err_msg);
    |             ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
148 -             eprintln!("{}", err_msg);
148 +             eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:162:31
    |
162 |                 let err_msg = format!("No file URI in response: {:?}", response_json);
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
162 -                 let err_msg = format!("No file URI in response: {:?}", response_json);
162 +                 let err_msg = format!("No file URI in response: {response_json:?}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:163:17
    |
163 |                 eprintln!("{}", err_msg);
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
163 -                 eprintln!("{}", err_msg);
163 +                 eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:173:31
    |
173 |                 let err_msg = format!("No file name in response: {:?}", response_json);
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
173 -                 let err_msg = format!("No file name in response: {:?}", response_json);
173 +                 let err_msg = format!("No file name in response: {response_json:?}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:174:17
    |
174 |                 eprintln!("{}", err_msg);
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
174 -                 eprintln!("{}", err_msg);
174 +                 eprintln!("{err_msg}");
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/google.rs:179:9
    |
179 | /         eprintln!(
180 | |             "Successfully uploaded file: {} (URI: {})",
181 | |             file_name, file_uri
182 | |         );
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: the function has a cognitive complexity of (33/30)
   --> src/services/llm/providers/google.rs:322:14
    |
322 |     async fn handle_streaming(
    |              ^^^^^^^^^^^^^^^^
    |
    = help: you could split it up into multiple smaller functions
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cognitive_complexity

error: consider adding a `;` to the last statement for consistent formatting
   --> src/services/llm/providers/google.rs:374:17
    |
374 |                 futures::future::pending::<()>().await
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: add a `;` here: `futures::future::pending::<()>().await;`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#semicolon_if_nothing_returned

error: matching over `()` is more explicit
   --> src/services/llm/providers/google.rs:370:13
    |
370 |             _ = async {
    |             ^ help: use `()` instead of `_`: `()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#ignored_unit_patterns

error: redundant closure
   --> src/services/llm/providers/google.rs:430:59
    |
430 | ...                   .and_then(|t| t.as_bool())
    |                                 ^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_bool`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/services/llm/providers/google.rs:520:47
    |
520 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/google.rs:521:46
    |
521 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
521 -                                     .map(|v| v as u32),
521 +                                     .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/google.rs:524:47
    |
524 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/google.rs:525:46
    |
525 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
525 -                                     .map(|v| v as u32),
525 +                                     .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/google.rs:528:47
    |
528 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/google.rs:529:46
    |
529 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
529 -                                     .map(|v| v as u32),
529 +                                     .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/google.rs:627:43
    |
627 | ...                   .and_then(|t| t.as_bool())
    |                                 ^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_bool`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/services/llm/providers/google.rs:682:27
    |
682 |                 .and_then(|v| v.as_u64())
    |                           ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/google.rs:683:26
    |
683 |                 .map(|v| v as u32),
    |                          ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
683 -                 .map(|v| v as u32),
683 +                 .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/google.rs:686:27
    |
686 |                 .and_then(|v| v.as_u64())
    |                           ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/google.rs:687:26
    |
687 |                 .map(|v| v as u32),
    |                          ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
687 -                 .map(|v| v as u32),
687 +                 .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/google.rs:690:27
    |
690 |                 .and_then(|v| v.as_u64())
    |                           ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/google.rs:691:26
    |
691 |                 .map(|v| v as u32),
    |                          ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
691 -                 .map(|v| v as u32),
691 +                 .map(|v| u32::try_from(v)),
    |

error: you seem to be trying to use `match` for destructuring a single pattern. Consider using `if let`
   --> src/services/llm/providers/google.rs:743:9
    |
743 | /         match self.client.get(&url).send().await {
744 | |             Ok(response) => {
745 | |                 if response.status().is_success() {
746 | |                     if let Ok(json) = response.json::<serde_json::Value>().await {
...   |
808 | |         }
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#single_match_else
    = note: `-D clippy::single-match-else` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::single_match_else)]`
help: try
    |
743 ~         if let Ok(response) = self.client.get(&url).send().await {
744 +             if response.status().is_success() {
745 +                 if let Ok(json) = response.json::<serde_json::Value>().await {
746 +                     if let Some(models) = json.get("models").and_then(|m| m.as_array()) {
747 +                         let mapped_models: Vec<LLMModel> = models
748 +                             .iter()
749 +                             .filter_map(|m| {
750 +                                 // Filter by supportedGenerationMethods
751 +                                 let supports_generate = m
752 +                                     .get("supportedGenerationMethods")
753 +                                     .and_then(|v| v.as_array())
754 +                                     .map(|methods| {
755 +                                         methods.iter().any(|method| {
756 +                                             method
757 +                                                 .as_str()
758 +                                                 .map_or(false, |s| s == "generateContent")
759 +                                         })
760 +                                     })
761 +                                     .unwrap_or(false); // If field missing, assume false or check docs? Docs say it's there.
762 + 
763 +                                 if !supports_generate {
764 +                                     return None;
765 +                                 }
766 + 
767 +                                 let id = m.get("name")?.as_str()?.to_string(); // format: "models/gemini-pro"
768 +                                 let name = m
769 +                                     .get("displayName")
770 +                                     .and_then(|v| v.as_str())
771 +                                     .unwrap_or(&id)
772 +                                     .to_string();
773 + 
774 +                                 // Clean up ID (remove "models/" prefix if present)
775 +                                 let clean_id =
776 +                                     id.strip_prefix("models/").unwrap_or(&id).to_string();
777 + 
778 +                                 // Check model capabilities
779 +                                 let (
780 +                                     supports_tools,
781 +                                     supports_thinking,
782 +                                     supports_image_generation,
783 +                                 ) = Self::check_model_capabilities(&clean_id);
784 + 
785 +                                 Some(LLMModel {
786 +                                     id: clean_id,
787 +                                     name,
788 +                                     created: None,
789 +                                     owned_by: Some("Google".to_string()),
790 +                                     supports_tools,
791 +                                     supports_thinking,
792 +                                     supports_image_generation,
793 +                                 })
794 +                             })
795 +                             .collect();
796 + 
797 +                         if !mapped_models.is_empty() {
798 +                             return Ok(mapped_models);
799 +                         }
800 +                     }
801 +                 }
802 +             }
803 +         } else {
804 +             // Ignore error and fall back
805 +         }
    |

error: called `map(<f>).unwrap_or(false)` on an `Option` value
   --> src/services/llm/providers/google.rs:752:61
    |
752 |   ...                   let supports_generate = m
    |  _______________________________________________^
753 | | ...                       .get("supportedGenerationMethods")
754 | | ...                       .and_then(|v| v.as_array())
755 | | ...                       .map(|methods| {
...   |
761 | | ...                       })
762 | | ...                       .unwrap_or(false); // If field missing, assume false or check docs? Docs say it's there.
    | |___________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#map_unwrap_or
help: use `is_some_and(<f>)` instead
    |
755 ~                                         .is_some_and(|methods| {
756 |                                             methods.iter().any(|method| {
...
760 |                                             })
761 ~                                         }); // If field missing, assume false or check docs? Docs say it's there.
    |

error: this `map_or` can be simplified
   --> src/services/llm/providers/google.rs:757:49
    |
757 | / ...                   method
758 | | ...                       .as_str()
759 | | ...                       .map_or(false, |s| s == "generateContent")
    | |____________________________________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unnecessary_map_or
    = note: `-D clippy::unnecessary-map-or` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::unnecessary_map_or)]`
help: use a standard comparison instead
    |
757 ~                                                 method
758 +                                                     .as_str() == Some("generateContent")
    |

error: wildcard matches only a single variant and will also match any future added variants
    --> src/services/llm/providers/google.rs:1095:17
     |
1095 |                 _ => {} // Tool messages not yet fully supported in this simple implementation
     |                 ^ help: try: `ChatMessage::Tool{ .. }`
     |
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#match_wildcard_for_single_variants

error: this match arm has an identical body to the `_` wildcard arm
    --> src/services/llm/providers/google.rs:1175:29
     |
1175 | ...                   "medium" => 8192, // Balanced thinking
     |                       ^^^^^^^^^^^^^^^^^^ help: try removing the arm
     |
     = help: or try changing either arm body
note: `_` wildcard arm here
    --> src/services/llm/providers/google.rs:1177:29
     |
1177 | ...                   _ => 8192,        // Default to medium
     |                       ^^^^^^^^^
     = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#match_same_arms

error: usage of wildcard import
 --> src/services/llm/providers/openai.rs:4:5
  |
4 | use crate::models::llm_types::*;
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `crate::models::llm_types::{ChatMessage, UserContent, ContentPart, AssistantContent, LLMChatResponse, ToolCall, TokenUsage, ToolCallFunction, LLMModel, LLMChatRequest}`
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports

error: this could be a `const fn`
  --> src/services/llm/providers/openai.rs:17:5
   |
17 | /     pub fn new(client: Arc<Client>) -> Self {
18 | |         Self { client }
19 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
17 |     pub const fn new(client: Arc<Client>) -> Self {
   |         +++++

error: called `Iterator::last` on a `DoubleEndedIterator`; this will needlessly iterate the entire iterator
  --> src/services/llm/providers/openai.rs:23:24
   |
23 |         let clean_id = model_id.split('/').last().unwrap_or(model_id);
   |                        ^^^^^^^^^^^^^^^^^^^^------
   |                                            |
   |                                            help: try: `next_back()`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#double_ended_iterator_last

error: the function has a cognitive complexity of (31/30)
   --> src/services/llm/providers/openai.rs:162:14
    |
162 |     async fn handle_responses_api(
    |              ^^^^^^^^^^^^^^^^^^^^
    |
    = help: you could split it up into multiple smaller functions
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cognitive_complexity

error: this function has too many arguments (8/7)
   --> src/services/llm/providers/openai.rs:162:5
    |
162 | /     async fn handle_responses_api(
163 | |         &self,
164 | |         req_builder: reqwest::RequestBuilder,
165 | |         request_body: serde_json::Value,
...   |
170 | |         is_streaming_requested: bool,
171 | |     ) -> Result<LLMChatResponse, AppError> {
    | |__________________________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: consider adding a `;` to the last statement for consistent formatting
   --> src/services/llm/providers/openai.rs:212:17
    |
212 |                 futures::future::pending::<()>().await
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: add a `;` here: `futures::future::pending::<()>().await;`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#semicolon_if_nothing_returned

error: matching over `()` is more explicit
   --> src/services/llm/providers/openai.rs:208:13
    |
208 |             _ = async {
    |             ^ help: use `()` instead of `_`: `()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#ignored_unit_patterns

error: this pattern reimplements `Option::unwrap_or`
   --> src/services/llm/providers/openai.rs:258:32
    |
258 |                           } else if let Some(t) = type_from_data {
    |  ________________________________^
259 | |                             t
260 | |                         } else {
261 | |                             "unknown"
262 | |                         };
    | |_________________________^ help: replace with: `type_from_data.unwrap_or("unknown")`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#manual_unwrap_or
    = note: `-D clippy::manual-unwrap-or` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::manual_unwrap_or)]`

error: redundant closure
   --> src/services/llm/providers/openai.rs:328:55
    |
328 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai.rs:329:54
    |
329 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
329 -                                             .map(|v| v as u32),
329 +                                             .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/openai.rs:332:55
    |
332 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai.rs:333:54
    |
333 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
333 -                                             .map(|v| v as u32),
333 +                                             .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/openai.rs:336:55
    |
336 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai.rs:337:54
    |
337 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
337 -                                             .map(|v| v as u32),
337 +                                             .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/openai.rs:350:55
    |
350 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai.rs:351:54
    |
351 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
351 -                                             .map(|v| v as u32),
351 +                                             .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/openai.rs:354:55
    |
354 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai.rs:355:54
    |
355 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
355 -                                             .map(|v| v as u32),
355 +                                             .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/openai.rs:358:55
    |
358 | ...                   .and_then(|v| v.as_u64())
    |                                 ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai.rs:359:54
    |
359 | ...                   .map(|v| v as u32),
    |                                ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
359 -                                             .map(|v| v as u32),
359 +                                             .map(|v| u32::try_from(v)),
    |

error: variables can be used directly in the `format!` string
   --> src/services/llm/providers/openai.rs:399:29
    |
399 | ...                   eprintln!("Failed to parse SSE data: {} - Data: {}", e, event_data_str);
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
399 -                             eprintln!("Failed to parse SSE data: {} - Data: {}", e, event_data_str);
399 +                             eprintln!("Failed to parse SSE data: {e} - Data: {event_data_str}");
    |

error: redundant closure
   --> src/services/llm/providers/openai.rs:496:55
    |
496 |                 created: item.get("created").and_then(|v| v.as_u64()),
    |                                                       ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/services/llm/providers/openai.rs:500:26
    |
500 |                     .map(|s| s.to_string()),
    |                          ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: `to_string` applied to a type that implements `Display` in `format!` args
   --> src/services/llm/providers/openai.rs:514:21
    |
514 |                 json.to_string()
    |                     ^^^^^^^^^^^^ help: remove this
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#to_string_in_format_args
    = note: `-D clippy::to-string-in-format-args` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::to_string_in_format_args)]`

error: usage of wildcard import
 --> src/services/llm/providers/openai_compat.rs:4:5
  |
4 | use crate::models::llm_types::*;
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `crate::models::llm_types::{LLMChatResponse, ToolCall, TokenUsage, SSEChunk, ToolCallFunction, LLMModel, LLMChatRequest}`
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports

error: this could be a `const fn`
  --> src/services/llm/providers/openai_compat.rs:16:5
   |
16 | /     pub fn new(client: Arc<Client>) -> Self {
17 | |         Self { client }
18 | |     }
   | |_____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_const_for_fn
help: make the function `const`
   |
16 |     pub const fn new(client: Arc<Client>) -> Self {
   |         +++++

error: called `Iterator::last` on a `DoubleEndedIterator`; this will needlessly iterate the entire iterator
  --> src/services/llm/providers/openai_compat.rs:22:24
   |
22 |         let clean_id = model_id.split('/').last().unwrap_or(model_id);
   |                        ^^^^^^^^^^^^^^^^^^^^------
   |                                            |
   |                                            help: try: `next_back()`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#double_ended_iterator_last

error: consider adding a `;` to the last statement for consistent formatting
  --> src/services/llm/providers/openai_compat.rs:89:17
   |
89 |                 futures::future::pending::<()>().await
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: add a `;` here: `futures::future::pending::<()>().await;`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#semicolon_if_nothing_returned

error: matching over `()` is more explicit
  --> src/services/llm/providers/openai_compat.rs:85:13
   |
85 |             _ = async {
   |             ^ help: use `()` instead of `_`: `()`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#ignored_unit_patterns

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:349:18
    |
349 |             .map(|s| s.to_string());
    |                  ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:364:58
    |
364 | ...                   .and_then(|a| a.as_str().map(|s| s.to_string()))
    |                                                    ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:413:27
    |
413 |                 .and_then(|v| v.as_u64())
    |                           ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai_compat.rs:414:26
    |
414 |                 .map(|v| v as u32),
    |                          ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
414 -                 .map(|v| v as u32),
414 +                 .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:417:27
    |
417 |                 .and_then(|v| v.as_u64())
    |                           ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai_compat.rs:418:26
    |
418 |                 .map(|v| v as u32),
    |                          ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
418 -                 .map(|v| v as u32),
418 +                 .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:421:27
    |
421 |                 .and_then(|v| v.as_u64())
    |                           ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: casting `u64` to `u32` may truncate the value
   --> src/services/llm/providers/openai_compat.rs:422:26
    |
422 |                 .map(|v| v as u32),
    |                          ^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
422 -                 .map(|v| v as u32),
422 +                 .map(|v| u32::try_from(v)),
    |

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:509:22
    |
509 |                 .map(|s| s.to_string());
    |                      ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:517:22
    |
517 |                 .map(|s| s.to_string());
    |                      ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:528:59
    |
528 |                     created: item.get("created").and_then(|v| v.as_u64()),
    |                                                           ^^^^^^^^^^^^^^ help: replace the closure with the method itself: `serde_json::Value::as_u64`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: redundant closure
   --> src/services/llm/providers/openai_compat.rs:533:30
    |
533 |                         .map(|s| s.to_string()),
    |                              ^^^^^^^^^^^^^^^^^ help: replace the closure with the method itself: `std::string::ToString::to_string`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls

error: `to_string` applied to a type that implements `Display` in `format!` args
   --> src/services/llm/providers/openai_compat.rs:570:25
    |
570 |                     json.to_string()
    |                         ^^^^^^^^^^^^ help: remove this
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#to_string_in_format_args

error: usage of wildcard import
 --> src/services/llm/providers/mod.rs:7:5
  |
7 | use crate::models::llm_types::*;
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `crate::models::llm_types::{LLMModel, LLMChatRequest, LLMChatResponse}`
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports

error: this function has too many arguments (8/7)
  --> src/services/llm/providers/mod.rs:16:15
   |
16 |   #[async_trait]
   |  _______________^
17 | | pub trait LLMProvider: Send + Sync {
18 | |     async fn fetch_models(
19 | |         &self,
...  |
24 | |     async fn chat(
   | |____^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: usage of wildcard import
 --> src/services/llm/mod.rs:4:5
  |
4 | use crate::models::llm_types::*;
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `crate::models::llm_types::{LLMModel, LLMChatRequest, LLMChatResponse}`
  |
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports

error: this match arm has an identical body to the `_` wildcard arm
  --> src/services/llm/mod.rs:34:13
   |
34 | /             "deepseek" | "groq" | "ollama" | "perplexity" | "mistral" | "openrouter"
35 | |             | "lmstudio" | "localai" => Box::new(OpenAICompatProvider::new(self.client.clone())),
36 | |             // Default fallback to OpenAI compatible for any custom/unknown provider
   | |____________^ help: try removing the arm
   |
   = help: or try changing either arm body
note: `_` wildcard arm here
  --> src/services/llm/mod.rs:37:13
   |
37 |             _ => Box::new(OpenAICompatProvider::new(self.client.clone())),
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#match_same_arms

error: this function has too many arguments (9/7)
  --> src/services/llm/mod.rs:53:5
   |
53 | /     pub async fn chat(
54 | |         &self,
55 | |         base_url: &str,
56 | |         api_key: Option<&str>,
...  |
62 | |         provider: &str,
63 | |     ) -> Result<LLMChatResponse, AppError> {
   | |__________________________________________^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#too_many_arguments

error: usage of wildcard import
  --> src/state/app_state.rs:28:5
   |
28 | use crate::services::*;
   |     ^^^^^^^^^^^^^^^^^^ help: try: `crate::services::LLMService`
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wildcard_imports

error: this argument is passed by value, but not consumed in the function body
  --> src/state/app_state.rs:67:21
   |
67 |     pub fn new(app: Arc<AppHandle>) -> Result<Self, crate::error::AppError> {
   |                     ^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_pass_by_value
help: consider taking a reference instead
   |
67 |     pub fn new(app: &Arc<AppHandle>) -> Result<Self, crate::error::AppError> {
   |                     +

error: redundant clone
   --> src/state/app_state.rs:114:30
    |
114 |             workspace_service.clone(),
    |                              ^^^^^^^^ help: remove this
    |
note: this value is dropped without further use
   --> src/state/app_state.rs:114:13
    |
114 |             workspace_service.clone(),
    |             ^^^^^^^^^^^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone

error: redundant clone
   --> src/state/app_state.rs:135:24
    |
135 |             llm_service.clone(),
    |                        ^^^^^^^^ help: remove this
    |
note: this value is dropped without further use
   --> src/state/app_state.rs:135:13
    |
135 |             llm_service.clone(),
    |             ^^^^^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone

error: redundant clone
   --> src/state/app_state.rs:137:39
    |
137 |             workspace_settings_service.clone(),
    |                                       ^^^^^^^^ help: remove this
    |
note: this value is dropped without further use
   --> src/state/app_state.rs:137:13
    |
137 |             workspace_settings_service.clone(),
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone

error: redundant clone
   --> src/state/app_state.rs:155:33
    |
155 |         mcp_tool_refresh_service.clone().start_background_refresh();
    |                                 ^^^^^^^^ help: remove this
    |
note: this value is dropped without further use
   --> src/state/app_state.rs:155:9
    |
155 |         mcp_tool_refresh_service.clone().start_background_refresh();
    |         ^^^^^^^^^^^^^^^^^^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone

error: variables can be used directly in the `format!` string
   --> src/lib/sentry_helpers.rs:108:13
    |
108 | /             format!(
109 | |                 "LLM call to {} ({}) - {} - {}ms",
110 | |                 provider, model, operation, latency_ms
111 | |             ),
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/lib/sentry_helpers.rs:121:38
    |
121 |             sentry::capture_message(&format!("LLM call failed: {}", e), sentry::Level::Error);
    |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
121 -             sentry::capture_message(&format!("LLM call failed: {}", e), sentry::Level::Error);
121 +             sentry::capture_message(&format!("LLM call failed: {e}"), sentry::Level::Error);
    |

error: variables can be used directly in the `format!` string
   --> src/lib/sentry_helpers.rs:158:18
    |
158 |                 &format!("Tool execution failed: {}", e),
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
158 -                 &format!("Tool execution failed: {}", e),
158 +                 &format!("Tool execution failed: {e}"),
    |

error: variables can be used directly in the `format!` string
   --> src/lib/sentry_helpers.rs:176:13
    |
176 | /             format!(
177 | |                 "Message {} ({}) - {} - {}",
178 | |                 message_id, message_type, action, chat_id
179 | |             ),
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/lib/sentry_helpers.rs:195:13
    |
195 |             format!("Workspace {} - {}", workspace_id, operation),
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
195 -             format!("Workspace {} - {}", workspace_id, operation),
195 +             format!("Workspace {workspace_id} - {operation}"),
    |

error: casting `u128` to `u64` may truncate the value
   --> src/lib/sentry_helpers.rs:215:47
    |
215 |             scope.set_extra("db.duration_ms", (duration_ms as u64).into());
    |                                               ^^^^^^^^^^^^^^^^^^^^
    |
    = help: if this is intentional allow the lint with `#[allow(clippy::cast_possible_truncation)]` ...
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#cast_possible_truncation
help: ... or use `try_from` and handle the error accordingly
    |
215 -             scope.set_extra("db.duration_ms", (duration_ms as u64).into());
215 +             scope.set_extra("db.duration_ms", u64::try_from(duration_ms).into());
    |

error: variables can be used directly in the `format!` string
   --> src/lib/sentry_helpers.rs:222:17
    |
222 | /                 format!(
223 | |                     "SLOW QUERY: {} on {} took {}ms",
224 | |                     operation, table, duration_ms
225 | |                 ),
    | |_________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args

error: variables can be used directly in the `format!` string
   --> src/lib/sentry_helpers.rs:232:18
    |
232 |                 &format!("DB operation {} on {} failed: {}", operation, table, e),
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
    |
232 -                 &format!("DB operation {} on {} failed: {}", operation, table, e),
232 +                 &format!("DB operation {operation} on {table} failed: {e}"),
    |

error: docs for function which may panic missing `# Panics` section
   --> src/lib.rs:62:1
    |
62  | pub fn run() {
    | ^^^^^^^^^^^^
    |
note: first possible panic found here
   --> src/lib.rs:67:5
    |
67  | /     builder
68  | |         .plugin(tauri_plugin_clipboard_manager::init())
69  | |         .plugin(tauri_plugin_opener::init())
70  | |         .plugin(tauri_plugin_dialog::init())
...   |
228 | |         .run(tauri::generate_context!())
229 | |         .expect("error while running tauri application");
    | |________________________________________________________^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#missing_panics_doc
    = note: `-D clippy::missing-panics-doc` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::missing_panics_doc)]`

error: redundant clone
  --> src/lib.rs:85:46
   |
85 |                     let window_clone = window.clone();
   |                                              ^^^^^^^^ help: remove this
   |
note: this value is dropped without further use
  --> src/lib.rs:85:40
   |
85 |                     let window_clone = window.clone();
   |                                        ^^^^^^
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone

error: variables can be used directly in the `format!` string
  --> src/lib.rs:79:21
   |
79 |                     eprintln!("Failed to maximize window: {}", e);
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
79 -                     eprintln!("Failed to maximize window: {}", e);
79 +                     eprintln!("Failed to maximize window: {e}");
   |

error: variables can be used directly in the `format!` string
  --> src/lib.rs:94:29
   |
94 | ...                   eprintln!("Failed to set window position: {}", e);
   |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#uninlined_format_args
help: change this to
   |
94 -                             eprintln!("Failed to set window position: {}", e);
94 +                             eprintln!("Failed to set window position: {e}");
   |

error: used underscore-prefixed binding
   --> src/lib.rs:132:41
    |
132 |                 menu::handle_menu_event(_window.app_handle(), id_str);
    |                                         ^^^^^^^
    |
note: binding is defined here
   --> src/lib.rs:128:32
    |
128 |             app.on_menu_event(|_window, event| {
    |                                ^^^^^^^
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#used_underscore_binding
    = note: `-D clippy::used-underscore-binding` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::used_underscore_binding)]`

error: this function may allocate 727375 bytes on the stack
   --> src/lib.rs:228:14
    |
228 |         .run(tauri::generate_context!())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^ this is the largest part, at 4480 bytes for type `tauri::Context<R>`
    |
    = note: 727375 bytes is larger than Clippy's configured `stack-size-threshold` of 512000
    = note: allocating large amounts of stack space can overflow the stack and cause the program to abort
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#large_stack_frames
    = note: `-D clippy::large-stack-frames` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::large_stack_frames)]`
    = note: this error originates in the macro `tauri::generate_context` (in Nightly builds, run with -Z macro-backtrace for more info)

error: unused `async` for function with no await statements
   --> src/features/runtime/node/service.rs:115:5
    |
115 | /     pub async fn install(app: &AppHandle, full_version: &str) -> Result<(), AppError> {
116 | |         let fnm_path = get_bundled_fnm_path(app)?;
117 | |         let app_data = app.path().app_data_dir().map_err(AppError::Tauri)?;
118 | |         let fnm_dir = app_data.join("node-runtimes");
...   |
158 | |         Ok(())
159 | |     }
    | |_____^
    |
    = help: consider removing the `async` from this function
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_async
    = note: `-D clippy::unused-async` implied by `-D warnings`
    = help: to override `-D warnings` add `#[allow(clippy::unused_async)]`

error: unused `async` for function with no await statements
   --> src/features/runtime/python/service.rs:290:5
    |
290 | /     pub async fn install_packages(
291 | |         app: &AppHandle,
292 | |         python_path: &PathBuf,
293 | |         packages: &[String],
...   |
335 | |         Ok(())
336 | |     }
    | |_____^
    |
    = help: consider removing the `async` from this function
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_async

error: unused `async` for function with no await statements
   --> src/features/agent/manager.rs:199:5
    |
199 | /     async fn install_from_directory(&self, source_dir: &Path, version_ref: &str) -> Result<String> {
200 | |         // 1. Validate Manifest
201 | |         let manifest = common::verify_agent_directory(source_dir)?;
202 | |         let agent_id = &manifest.id;
...   |
254 | |         Ok(agent_id.clone())
255 | |     }
    | |_____^
    |
    = help: consider removing the `async` from this function
    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#unused_async

warning: nexo@0.1.0-alpha.48: Binary found: /Users/nkthanh/code/nexo-project/nexo/src-tauri/binaries/uv
warning: nexo@0.1.0-alpha.48: Binary found: /Users/nkthanh/code/nexo-project/nexo/src-tauri/binaries/fnm
warning: nexo@0.1.0-alpha.48: RUST_SENTRY_DSN not set - Sentry will be disabled
error: could not compile `nexo` (lib) due to 466 previous errors
error Command failed with exit code 101.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
